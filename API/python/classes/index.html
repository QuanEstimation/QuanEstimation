
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Docs of QuanEstimation">
      
      
        <meta name="author" content="QuanEstimation">
      
      
        <link rel="canonical" href="https://quanestimation.github.io/QuanEstimation/API/python/classes/">
      
      
        <link rel="prev" href="../../../guide/output_files/">
      
      
        <link rel="next" href="../functions/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Classes - QuanEstimation Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/style.css">
    
      <link rel="stylesheet" href="../../../css/material.css">
    
      <link rel="stylesheet" href="../../../css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
      <link rel="stylesheet" href="../../../css/julia_api.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dynamics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="QuanEstimation Docs" class="md-header__button md-logo" aria-label="QuanEstimation Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.92 7.92 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.92 7.92 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.92 7.92 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.92 7.92 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69zM12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QuanEstimation Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Classes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/QuanEstimation/QuanEstimation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../installation/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../guide/guide_import/" class="md-tabs__link">
          
  
  
  Users Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API documentation

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../examples/" class="md-tabs__link">
        
  
  
    
  
  Examples

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../citing/" class="md-tabs__link">
        
  
  
    
  
  Citing

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../developers/" class="md-tabs__link">
        
  
  
    
  
  Developers

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="QuanEstimation Docs" class="md-nav__button md-logo" aria-label="QuanEstimation Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.92 7.92 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.92 7.92 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.92 7.92 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.92 7.92 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69zM12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"/></svg>

    </a>
    QuanEstimation Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/QuanEstimation/QuanEstimation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Users Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Users Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_import/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_dynamics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameterization process
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_bounds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum metrological tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrological resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_Copt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_Sopt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_Mopt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Measurement optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_Compopt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comprehensive optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/guide_adaptive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adaptive measurement schemes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/output_files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Output files
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Classes
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Classes
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad" class="md-nav__link">
    <span class="md-ellipsis">
      Lindblad
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad.expm" class="md-nav__link">
    <span class="md-ellipsis">
      expm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad.ode" class="md-nav__link">
    <span class="md-ellipsis">
      ode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad.secondorder_derivative" class="md-nav__link">
    <span class="md-ellipsis">
      secondorder_derivative
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Control Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Control Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem" class="md-nav__link">
    <span class="md-ellipsis">
      ControlSystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ControlSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mintime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-optimization-with-grape-and-auto-grape" class="md-nav__link">
    <span class="md-ellipsis">
      Control optimization with GRAPE and auto-GRAPE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt" class="md-nav__link">
    <span class="md-ellipsis">
      GRAPE_Copt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRAPE_Copt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mintime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      Control Optimization with PSO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Copt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Copt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mintime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-optimization-de" class="md-nav__link">
    <span class="md-ellipsis">
      Control Optimization DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Copt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Copt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      State Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_1" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem" class="md-nav__link">
    <span class="md-ellipsis">
      StateSystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StateSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.StateSystem--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-with-ad" class="md-nav__link">
    <span class="md-ellipsis">
      State optimization with AD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      AD_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AD_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-with-ri" class="md-nav__link">
    <span class="md-ellipsis">
      State optimization with RI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      RI_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RI_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      State Optimization with PSO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-de" class="md-nav__link">
    <span class="md-ellipsis">
      State Optimization DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measurement-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measurement Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_2" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem" class="md-nav__link">
    <span class="md-ellipsis">
      MeasurementSystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#measurement-optimization-with-ad" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement optimization with AD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      AD_Mopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AD_Mopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.AD_Mopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Mopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measurement-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement Optimization with PSO
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Mopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Mopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Mopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Mopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#measurement-optimization-with-de" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement Optimization with DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Mopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Mopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Mopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Mopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprehensive-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprehensive Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_3" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem" class="md-nav__link">
    <span class="md-ellipsis">
      ComprehensiveSystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ComprehensiveSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.CM" class="md-nav__link">
    <span class="md-ellipsis">
      CM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.SCM" class="md-nav__link">
    <span class="md-ellipsis">
      SCM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.SM" class="md-nav__link">
    <span class="md-ellipsis">
      SM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-optimization-with-ad" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive optimization with AD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Compopt" class="md-nav__link">
    <span class="md-ellipsis">
      AD_Compopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AD_Compopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.AD_Compopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Compopt.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Optimization with PSO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Compopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Compopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.CM" class="md-nav__link">
    <span class="md-ellipsis">
      CM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.SCM" class="md-nav__link">
    <span class="md-ellipsis">
      SCM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.SM" class="md-nav__link">
    <span class="md-ellipsis">
      SM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-optimization-with-de" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Optimization with DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Compopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Compopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.CM" class="md-nav__link">
    <span class="md-ellipsis">
      CM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.SCM" class="md-nav__link">
    <span class="md-ellipsis">
      SCM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.SM" class="md-nav__link">
    <span class="md-ellipsis">
      SM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptive-measurement-schemes" class="md-nav__link">
    <span class="md-ellipsis">
      Adaptive measurement schemes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adaptive measurement schemes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adaptive-measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Adaptive measurement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt" class="md-nav__link">
    <span class="md-ellipsis">
      Adapt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adapt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.Adapt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      Mopt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI" class="md-nav__link">
    <span class="md-ellipsis">
      Adapt_MZI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adapt_MZI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI.offline" class="md-nav__link">
    <span class="md-ellipsis">
      offline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI.online" class="md-nav__link">
    <span class="md-ellipsis">
      online
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../julia/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Julia
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../citing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developers
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad" class="md-nav__link">
    <span class="md-ellipsis">
      Lindblad
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad.expm" class="md-nav__link">
    <span class="md-ellipsis">
      expm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad.ode" class="md-nav__link">
    <span class="md-ellipsis">
      ode
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Lindblad.secondorder_derivative" class="md-nav__link">
    <span class="md-ellipsis">
      secondorder_derivative
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Control Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Control Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem" class="md-nav__link">
    <span class="md-ellipsis">
      ControlSystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ControlSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ControlSystem.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mintime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-optimization-with-grape-and-auto-grape" class="md-nav__link">
    <span class="md-ellipsis">
      Control optimization with GRAPE and auto-GRAPE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt" class="md-nav__link">
    <span class="md-ellipsis">
      GRAPE_Copt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRAPE_Copt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.GRAPE_Copt.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mintime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      Control Optimization with PSO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Copt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Copt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Copt.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mintime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-optimization-de" class="md-nav__link">
    <span class="md-ellipsis">
      Control Optimization DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Copt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Copt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Copt.mintime" class="md-nav__link">
    <span class="md-ellipsis">
      mintime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      State Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="State Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_1" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem" class="md-nav__link">
    <span class="md-ellipsis">
      StateSystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StateSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.StateSystem--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.StateSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-with-ad" class="md-nav__link">
    <span class="md-ellipsis">
      State optimization with AD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      AD_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AD_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-with-ri" class="md-nav__link">
    <span class="md-ellipsis">
      State optimization with RI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      RI_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RI_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.RI_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      State Optimization with PSO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-optimization-de" class="md-nav__link">
    <span class="md-ellipsis">
      State Optimization DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Sopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Sopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt.HCRB" class="md-nav__link">
    <span class="md-ellipsis">
      HCRB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Sopt.QFIM" class="md-nav__link">
    <span class="md-ellipsis">
      QFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measurement-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Measurement Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_2" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem" class="md-nav__link">
    <span class="md-ellipsis">
      MeasurementSystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.MeasurementSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#measurement-optimization-with-ad" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement optimization with AD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      AD_Mopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AD_Mopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.AD_Mopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Mopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#measurement-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement Optimization with PSO
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Mopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Mopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Mopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Mopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#measurement-optimization-with-de" class="md-nav__link">
    <span class="md-ellipsis">
      Measurement Optimization with DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Mopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Mopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Mopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Mopt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprehensive-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprehensive Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base_3" class="md-nav__link">
    <span class="md-ellipsis">
      Base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem" class="md-nav__link">
    <span class="md-ellipsis">
      ComprehensiveSystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ComprehensiveSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.CM" class="md-nav__link">
    <span class="md-ellipsis">
      CM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.SCM" class="md-nav__link">
    <span class="md-ellipsis">
      SCM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.SM" class="md-nav__link">
    <span class="md-ellipsis">
      SM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.ComprehensiveSystem.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-optimization-with-ad" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive optimization with AD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Compopt" class="md-nav__link">
    <span class="md-ellipsis">
      AD_Compopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AD_Compopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.AD_Compopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.AD_Compopt.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-optimization-with-pso" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Optimization with PSO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt" class="md-nav__link">
    <span class="md-ellipsis">
      PSO_Compopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSO_Compopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.CM" class="md-nav__link">
    <span class="md-ellipsis">
      CM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.SCM" class="md-nav__link">
    <span class="md-ellipsis">
      SCM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.PSO_Compopt.SM" class="md-nav__link">
    <span class="md-ellipsis">
      SM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-optimization-with-de" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Optimization with DE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt" class="md-nav__link">
    <span class="md-ellipsis">
      DE_Compopt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DE_Compopt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.CM" class="md-nav__link">
    <span class="md-ellipsis">
      CM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.SC" class="md-nav__link">
    <span class="md-ellipsis">
      SC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.SCM" class="md-nav__link">
    <span class="md-ellipsis">
      SCM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.DE_Compopt.SM" class="md-nav__link">
    <span class="md-ellipsis">
      SM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptive-measurement-schemes" class="md-nav__link">
    <span class="md-ellipsis">
      Adaptive measurement schemes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adaptive measurement schemes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adaptive-measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Adaptive measurement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt" class="md-nav__link">
    <span class="md-ellipsis">
      Adapt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adapt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.Adapt--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.CFIM" class="md-nav__link">
    <span class="md-ellipsis">
      CFIM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.Kraus" class="md-nav__link">
    <span class="md-ellipsis">
      Kraus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.Mopt" class="md-nav__link">
    <span class="md-ellipsis">
      Mopt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt.dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      dynamics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI" class="md-nav__link">
    <span class="md-ellipsis">
      Adapt_MZI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adapt_MZI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI.offline" class="md-nav__link">
    <span class="md-ellipsis">
      offline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quanestimation.Adapt_MZI.online" class="md-nav__link">
    <span class="md-ellipsis">
      online
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Classes</h1>

<p>This part is the classes of the Python-Julia package which written in Python.</p>
<h2 id="dynamics"><strong>Dynamics</strong><a class="headerlink" href="#dynamics" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<a id="quanestimation.Lindblad"></a>
  <div class="doc doc-contents first">

  
      <p>Class for simulating quantum dynamics governed by the Lindblad master equation.</p>
<p>The dynamics of a density matrix is described by the Lindblad master equation:</p>
<div class="arithmatex">\[\begin{aligned}
    \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\
    &amp;=-i[H,\rho]+\sum_i \gamma_i(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}
    \{\rho,\Gamma^{\dagger}_i \Gamma_i \}),
\end{aligned}\]</div>

<details class="symbols" open>
  <summary>Symbols</summary>
  <ul>
<li><span class="arithmatex">\(\rho\)</span>: the evolved density matrix</li>
<li><span class="arithmatex">\(H\)</span>: the Hamiltonian of the system</li>
<li><span class="arithmatex">\(\Gamma_i\)</span>: the <span class="arithmatex">\(i\)</span>th decay operator</li>
<li><span class="arithmatex">\(\gamma_i\)</span>: the <span class="arithmatex">\(i\)</span>th decay rate</li>
</ul>
</details>


  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code><span title="quanestimation.Lindblad.tspan">tspan</span></code></td>
          <td>
                <code><span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Time points for the evolution.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="quanestimation.Lindblad.rho0">rho0</span></code></td>
          <td>
                <code><span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Initial state (density matrix).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="quanestimation.Lindblad.H0">H0</span></code></td>
          <td>
                <code><span title="numpy.array">array</span> / list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Free Hamiltonian. It is a matrix when time-independent, or a list of matrices 
(with length equal to <code>tspan</code>) when time-dependent.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="quanestimation.Lindblad.dH">dH</span></code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Derivatives of the free Hamiltonian with respect to the unknown parameters.<br />
Each element is a matrix representing the partial derivative with respect to 
one parameter. For example, <code>dH[0]</code> is the derivative with respect to the 
first parameter.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="quanestimation.Lindblad.decay">decay</span></code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Decay operators and corresponding decay rates. Input format:<br />
<code>decay=[[Γ₁, γ₁], [Γ₂, γ₂], ...]</code>, where Γ₁, Γ₂ are decay operators and γ₁, γ₂ 
are the corresponding decay rates.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="quanestimation.Lindblad.Hc">Hc</span></code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Control Hamiltonians.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code><span title="quanestimation.Lindblad.ctrl">ctrl</span></code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Control coefficients for each control Hamiltonian.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>quanestimation/Parameterization/GeneralDynamics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Lindblad</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for simulating quantum dynamics governed by the Lindblad master equation.</span>

<span class="sd">    The dynamics of a density matrix is described by the Lindblad master equation:</span>

<span class="sd">    \begin{aligned}</span>
<span class="sd">        \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">        &amp;=-i[H,\rho]+\sum_i \gamma_i(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">        \{\rho,\Gamma^{\dagger}_i \Gamma_i \}),</span>
<span class="sd">    \end{aligned}</span>

<span class="sd">    Symbols: </span>
<span class="sd">        - $\rho$: the evolved density matrix</span>
<span class="sd">        - $H$: the Hamiltonian of the system</span>
<span class="sd">        - $\Gamma_i$: the $i$th decay operator</span>
<span class="sd">        - $\gamma_i$: the $i$th decay rate</span>

<span class="sd">    Attributes:</span>
<span class="sd">        tspan (np.array): </span>
<span class="sd">            Time points for the evolution.</span>
<span class="sd">        rho0 (np.array): </span>
<span class="sd">            Initial state (density matrix).</span>
<span class="sd">        H0 (np.array/list): </span>
<span class="sd">            Free Hamiltonian. It is a matrix when time-independent, or a list of matrices </span>
<span class="sd">            (with length equal to `tspan`) when time-dependent.</span>
<span class="sd">        dH (list): </span>
<span class="sd">            Derivatives of the free Hamiltonian with respect to the unknown parameters.  </span>
<span class="sd">            Each element is a matrix representing the partial derivative with respect to </span>
<span class="sd">            one parameter. For example, `dH[0]` is the derivative with respect to the </span>
<span class="sd">            first parameter.</span>
<span class="sd">        decay (list): </span>
<span class="sd">            Decay operators and corresponding decay rates. Input format:  </span>
<span class="sd">            `decay=[[Γ₁, γ₁], [Γ₂, γ₂], ...]`, where Γ₁, Γ₂ are decay operators and γ₁, γ₂ </span>
<span class="sd">            are the corresponding decay rates.</span>
<span class="sd">        Hc (list): </span>
<span class="sd">            Control Hamiltonians.</span>
<span class="sd">        ctrl (list, optional): </span>
<span class="sd">            Control coefficients for each control Hamiltonian.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[]):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dH</span><span class="p">:</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">decay</span><span class="p">:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">Hc</span><span class="p">:</span>
            <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">ctrl</span><span class="p">:</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span> <span class="o">=</span> <span class="n">Hc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctrl_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
            <span class="n">ctrlnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ctrlnum</span> <span class="o">&lt;</span> <span class="n">ctrl_length</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: </span><span class="se">\</span>
<span class="s2">                                too many coefficients sequences&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">ctrlnum</span><span class="p">,</span> <span class="n">ctrl_length</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">ctrlnum</span> <span class="o">&gt;</span> <span class="n">ctrl_length</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians </span><span class="se">\</span>
<span class="s2">                            but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are</span><span class="se">\</span>
<span class="s2">                            set to be 0.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">ctrlnum</span><span class="p">,</span> <span class="n">ctrl_length</span><span class="p">),</span>
                    <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span> <span class="o">=</span> <span class="n">Hc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">expm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the density matrix and its derivatives using the matrix exponential method.</span>

<span class="sd">        The density matrix at the $j$th time interval is obtained by:</span>

<span class="sd">        $$</span>
<span class="sd">            \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1}</span>
<span class="sd">        $$</span>

<span class="sd">        where $\Delta t$ is the time interval and $\rho_{j-1}$ is the density matrix </span>
<span class="sd">        at the previous time step.</span>

<span class="sd">        The derivative $\partial_{\textbf{x}}\rho_j$ is calculated as:</span>

<span class="sd">        $$</span>
<span class="sd">            \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j</span>
<span class="sd">            + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1})</span>
<span class="sd">        $$</span>

<span class="sd">        Returns: </span>
<span class="sd">            (tuple):</span>
<span class="sd">                rho (list): </span>
<span class="sd">                    Density matrices at each time point in `tspan`.</span>

<span class="sd">                drho (list): </span>
<span class="sd">                    Derivatives of the density matrices with respect to the unknown parameters.  </span>
<span class="sd">                    `drho[i][j]` is the derivative of the density matrix at the i-th time point </span>
<span class="sd">                    with respect to the j-th parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">expm_py</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Convert Julia matrices to numpy arrays safely</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rho_i</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> <span class="k">for</span> <span class="n">rho_i</span> <span class="ow">in</span> <span class="n">rho</span><span class="p">]</span>
        <span class="n">drho</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> 
             <span class="k">for</span> <span class="n">drho_ij</span> <span class="ow">in</span> <span class="n">drho_i</span><span class="p">]</span> 
            <span class="k">for</span> <span class="n">drho_i</span> <span class="ow">in</span> <span class="n">drho</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the density matrix and its derivatives using an ODE solver.</span>

<span class="sd">        The density matrix at the $j$th time interval is obtained by:</span>

<span class="sd">        $$</span>
<span class="sd">            \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1},</span>
<span class="sd">        $$</span>

<span class="sd">        where $\Delta t$ is the time interval and $\rho_{j-1}$ is the density matrix </span>
<span class="sd">        at the previous time step.</span>

<span class="sd">        The derivative $\partial_{\textbf{x}}\rho_j$ is calculated as:</span>

<span class="sd">        $$</span>
<span class="sd">            \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j</span>
<span class="sd">            + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1}).</span>
<span class="sd">        $$</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple):</span>
<span class="sd">                rho (list): </span>
<span class="sd">                    Density matrices at each time point in `tspan`.</span>

<span class="sd">                drho (list): </span>
<span class="sd">                    Derivatives of the density matrices with respect to the unknown parameters.  </span>
<span class="sd">                    `drho[i][j]` is the derivative of the density matrix at the i-th time point </span>
<span class="sd">                    with respect to the j-th parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">ode_py</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Convert Julia matrices to numpy arrays safely</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rho_i</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> <span class="k">for</span> <span class="n">rho_i</span> <span class="ow">in</span> <span class="n">rho</span><span class="p">]</span>
        <span class="n">drho</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> 
             <span class="k">for</span> <span class="n">drho_ij</span> <span class="ow">in</span> <span class="n">drho_i</span><span class="p">]</span> 
            <span class="k">for</span> <span class="n">drho_i</span> <span class="ow">in</span> <span class="n">drho</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">secondorder_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d2H</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the density matrix, its first derivatives, and second derivatives </span>
<span class="sd">        with respect to the unknown parameters.</span>

<span class="sd">        The density matrix at the $j$th time interval is obtained by:</span>

<span class="sd">        $$</span>
<span class="sd">            \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1}.</span>
<span class="sd">        $$</span>

<span class="sd">        The first derivative $\partial_{\textbf{x}}\rho_j$ is calculated as:</span>

<span class="sd">        $$</span>
<span class="sd">            \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j</span>
<span class="sd">            + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1}).</span>
<span class="sd">        $$</span>

<span class="sd">        The second derivative $\partial_{\textbf{x}}^2\rho_j$ is calculated as:</span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">            \partial_{\textbf{x}}^2\rho_j =&amp; \Delta t (\partial_{\textbf{x}}^2\mathcal{L}) \rho_j </span>
<span class="sd">            + \Delta t (\partial_{\textbf{x}}\mathcal{L}) \partial_{\textbf{x}}\rho_j \\</span>
<span class="sd">            &amp;+ \Delta t (\partial_{\textbf{x}}\mathcal{L}) e^{\Delta t \mathcal{L}} \partial_{\textbf{x}}\rho_{j-1} </span>
<span class="sd">            + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}^2\rho_{j-1}).</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">        Args:</span>
<span class="sd">            d2H (list): Second-order derivatives of the free Hamiltonian with respect to the unknown parameters.  </span>
<span class="sd">                Each element is a matrix representing the second partial derivative with respect to </span>
<span class="sd">                two parameters. For example, `d2H[0]` might be the second derivative with respect to </span>
<span class="sd">                the first parameter twice, or a mixed partial derivative.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple):</span>
<span class="sd">                rho (list): </span>
<span class="sd">                    Density matrices at each time point in `tspan`.</span>

<span class="sd">                drho (list): </span>
<span class="sd">                    First derivatives of the density matrices with respect to the unknown parameters.</span>

<span class="sd">                d2rho (list): </span>
<span class="sd">                    Second derivatives of the density matrices with respect to the unknown parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">d2H</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d2H</span><span class="p">]</span>
        <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">,</span> <span class="n">d2rho</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">secondorder_derivative</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="n">d2H</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">rho_i</span> <span class="ow">in</span> <span class="n">rho</span><span class="p">]</span>
        <span class="n">drho</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">)</span> <span class="k">for</span> <span class="n">drho_ij</span> <span class="ow">in</span> <span class="n">drho_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">drho_i</span> <span class="ow">in</span> <span class="n">drho</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">,</span> <span class="n">d2rho</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.Lindblad.expm" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">expm</span><span class="p">()</span></code>

<a href="#quanestimation.Lindblad.expm" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Calculate the density matrix and its derivatives using the matrix exponential method.</p>
<p>The density matrix at the <span class="arithmatex">\(j\)</span>th time interval is obtained by:</p>
<div class="arithmatex">\[
    \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1}
\]</div>
<p>where <span class="arithmatex">\(\Delta t\)</span> is the time interval and <span class="arithmatex">\(\rho_{j-1}\)</span> is the density matrix 
at the previous time step.</p>
<p>The derivative <span class="arithmatex">\(\partial_{\textbf{x}}\rho_j\)</span> is calculated as:</p>
<div class="arithmatex">\[
    \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j
    + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1})
\]</div>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>rho (list): 
    Density matrices at each time point in <code>tspan</code>.</p>
<p>drho (list): 
    Derivatives of the density matrices with respect to the unknown parameters.<br />
<code>drho[i][j]</code> is the derivative of the density matrix at the i-th time point 
    with respect to the j-th parameter.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>quanestimation/Parameterization/GeneralDynamics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the density matrix and its derivatives using the matrix exponential method.</span>

<span class="sd">    The density matrix at the $j$th time interval is obtained by:</span>

<span class="sd">    $$</span>
<span class="sd">        \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1}</span>
<span class="sd">    $$</span>

<span class="sd">    where $\Delta t$ is the time interval and $\rho_{j-1}$ is the density matrix </span>
<span class="sd">    at the previous time step.</span>

<span class="sd">    The derivative $\partial_{\textbf{x}}\rho_j$ is calculated as:</span>

<span class="sd">    $$</span>
<span class="sd">        \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j</span>
<span class="sd">        + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1})</span>
<span class="sd">    $$</span>

<span class="sd">    Returns: </span>
<span class="sd">        (tuple):</span>
<span class="sd">            rho (list): </span>
<span class="sd">                Density matrices at each time point in `tspan`.</span>

<span class="sd">            drho (list): </span>
<span class="sd">                Derivatives of the density matrices with respect to the unknown parameters.  </span>
<span class="sd">                `drho[i][j]` is the derivative of the density matrix at the i-th time point </span>
<span class="sd">                with respect to the j-th parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">expm_py</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Convert Julia matrices to numpy arrays safely</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rho_i</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> <span class="k">for</span> <span class="n">rho_i</span> <span class="ow">in</span> <span class="n">rho</span><span class="p">]</span>
    <span class="n">drho</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">drho_ij</span> <span class="ow">in</span> <span class="n">drho_i</span><span class="p">]</span> 
        <span class="k">for</span> <span class="n">drho_i</span> <span class="ow">in</span> <span class="n">drho</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.Lindblad.ode" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">ode</span><span class="p">()</span></code>

<a href="#quanestimation.Lindblad.ode" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Calculate the density matrix and its derivatives using an ODE solver.</p>
<p>The density matrix at the <span class="arithmatex">\(j\)</span>th time interval is obtained by:</p>
<div class="arithmatex">\[
    \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1},
\]</div>
<p>where <span class="arithmatex">\(\Delta t\)</span> is the time interval and <span class="arithmatex">\(\rho_{j-1}\)</span> is the density matrix 
at the previous time step.</p>
<p>The derivative <span class="arithmatex">\(\partial_{\textbf{x}}\rho_j\)</span> is calculated as:</p>
<div class="arithmatex">\[
    \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j
    + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1}).
\]</div>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>rho (list): 
    Density matrices at each time point in <code>tspan</code>.</p>
<p>drho (list): 
    Derivatives of the density matrices with respect to the unknown parameters.<br />
<code>drho[i][j]</code> is the derivative of the density matrix at the i-th time point 
    with respect to the j-th parameter.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>quanestimation/Parameterization/GeneralDynamics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the density matrix and its derivatives using an ODE solver.</span>

<span class="sd">    The density matrix at the $j$th time interval is obtained by:</span>

<span class="sd">    $$</span>
<span class="sd">        \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1},</span>
<span class="sd">    $$</span>

<span class="sd">    where $\Delta t$ is the time interval and $\rho_{j-1}$ is the density matrix </span>
<span class="sd">    at the previous time step.</span>

<span class="sd">    The derivative $\partial_{\textbf{x}}\rho_j$ is calculated as:</span>

<span class="sd">    $$</span>
<span class="sd">        \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j</span>
<span class="sd">        + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1}).</span>
<span class="sd">    $$</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple):</span>
<span class="sd">            rho (list): </span>
<span class="sd">                Density matrices at each time point in `tspan`.</span>

<span class="sd">            drho (list): </span>
<span class="sd">                Derivatives of the density matrices with respect to the unknown parameters.  </span>
<span class="sd">                `drho[i][j]` is the derivative of the density matrix at the i-th time point </span>
<span class="sd">                with respect to the j-th parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">ode_py</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Convert Julia matrices to numpy arrays safely</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rho_i</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> <span class="k">for</span> <span class="n">rho_i</span> <span class="ow">in</span> <span class="n">rho</span><span class="p">]</span>
    <span class="n">drho</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">,</span> <span class="s1">&#39;_jl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="o">.</span><span class="n">_jl</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">drho_ij</span> <span class="ow">in</span> <span class="n">drho_i</span><span class="p">]</span> 
        <span class="k">for</span> <span class="n">drho_i</span> <span class="ow">in</span> <span class="n">drho</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.Lindblad.secondorder_derivative" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">secondorder_derivative</span><span class="p">(</span><span class="n">d2H</span><span class="p">)</span></code>

<a href="#quanestimation.Lindblad.secondorder_derivative" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Calculate the density matrix, its first derivatives, and second derivatives 
with respect to the unknown parameters.</p>
<p>The density matrix at the <span class="arithmatex">\(j\)</span>th time interval is obtained by:</p>
<div class="arithmatex">\[
    \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1}.
\]</div>
<p>The first derivative <span class="arithmatex">\(\partial_{\textbf{x}}\rho_j\)</span> is calculated as:</p>
<div class="arithmatex">\[
    \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j
    + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1}).
\]</div>
<p>The second derivative <span class="arithmatex">\(\partial_{\textbf{x}}^2\rho_j\)</span> is calculated as:</p>
<div class="arithmatex">\[\begin{aligned}
    \partial_{\textbf{x}}^2\rho_j =&amp; \Delta t (\partial_{\textbf{x}}^2\mathcal{L}) \rho_j 
    + \Delta t (\partial_{\textbf{x}}\mathcal{L}) \partial_{\textbf{x}}\rho_j \\
    &amp;+ \Delta t (\partial_{\textbf{x}}\mathcal{L}) e^{\Delta t \mathcal{L}} \partial_{\textbf{x}}\rho_{j-1} 
    + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}^2\rho_{j-1}).
\end{aligned}\]</div>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>d2H</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Second-order derivatives of the free Hamiltonian with respect to the unknown parameters.<br />
Each element is a matrix representing the second partial derivative with respect to 
two parameters. For example, <code>d2H[0]</code> might be the second derivative with respect to 
the first parameter twice, or a mixed partial derivative.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>rho (list): 
    Density matrices at each time point in <code>tspan</code>.</p>
<p>drho (list): 
    First derivatives of the density matrices with respect to the unknown parameters.</p>
<p>d2rho (list): 
    Second derivatives of the density matrices with respect to the unknown parameters.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>quanestimation/Parameterization/GeneralDynamics.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">secondorder_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d2H</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the density matrix, its first derivatives, and second derivatives </span>
<span class="sd">    with respect to the unknown parameters.</span>

<span class="sd">    The density matrix at the $j$th time interval is obtained by:</span>

<span class="sd">    $$</span>
<span class="sd">        \rho_j = e^{\Delta t \mathcal{L}} \rho_{j-1}.</span>
<span class="sd">    $$</span>

<span class="sd">    The first derivative $\partial_{\textbf{x}}\rho_j$ is calculated as:</span>

<span class="sd">    $$</span>
<span class="sd">        \partial_{\textbf{x}}\rho_j = \Delta t (\partial_{\textbf{x}}\mathcal{L}) \rho_j</span>
<span class="sd">        + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}\rho_{j-1}).</span>
<span class="sd">    $$</span>

<span class="sd">    The second derivative $\partial_{\textbf{x}}^2\rho_j$ is calculated as:</span>

<span class="sd">    \begin{aligned}</span>
<span class="sd">        \partial_{\textbf{x}}^2\rho_j =&amp; \Delta t (\partial_{\textbf{x}}^2\mathcal{L}) \rho_j </span>
<span class="sd">        + \Delta t (\partial_{\textbf{x}}\mathcal{L}) \partial_{\textbf{x}}\rho_j \\</span>
<span class="sd">        &amp;+ \Delta t (\partial_{\textbf{x}}\mathcal{L}) e^{\Delta t \mathcal{L}} \partial_{\textbf{x}}\rho_{j-1} </span>
<span class="sd">        + e^{\Delta t \mathcal{L}} (\partial_{\textbf{x}}^2\rho_{j-1}).</span>
<span class="sd">    \end{aligned}</span>

<span class="sd">    Args:</span>
<span class="sd">        d2H (list): Second-order derivatives of the free Hamiltonian with respect to the unknown parameters.  </span>
<span class="sd">            Each element is a matrix representing the second partial derivative with respect to </span>
<span class="sd">            two parameters. For example, `d2H[0]` might be the second derivative with respect to </span>
<span class="sd">            the first parameter twice, or a mixed partial derivative.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple):</span>
<span class="sd">            rho (list): </span>
<span class="sd">                Density matrices at each time point in `tspan`.</span>

<span class="sd">            drho (list): </span>
<span class="sd">                First derivatives of the density matrices with respect to the unknown parameters.</span>

<span class="sd">            d2rho (list): </span>
<span class="sd">                Second derivatives of the density matrices with respect to the unknown parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">d2H</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d2H</span><span class="p">]</span>
    <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">,</span> <span class="n">d2rho</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">secondorder_derivative</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
        <span class="n">d2H</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">rho_i</span> <span class="ow">in</span> <span class="n">rho</span><span class="p">]</span>
    <span class="n">drho</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drho_ij</span><span class="p">)</span> <span class="k">for</span> <span class="n">drho_ij</span> <span class="ow">in</span> <span class="n">drho_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">drho_i</span> <span class="ow">in</span> <span class="n">drho</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">,</span> <span class="n">d2rho</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h2 id="control-optimization"><strong>Control Optimization</strong><a class="headerlink" href="#control-optimization" title="Permanent link">&para;</a></h2>
<p>The Hamiltonian of a controlled system can be written as
\begin{align}
H = H_0(\textbf{x})+\sum_{k=1}^K u_k(t) H_k,
\end{align}</p>
<p>where <span class="arithmatex">\(H_0(\textbf{x})\)</span> is the free evolution Hamiltonian with unknown parameters 
<span class="arithmatex">\(\textbf{x}\)</span> and <span class="arithmatex">\(H_k\)</span> represents the <span class="arithmatex">\(k\)</span>th control Hamiltonian with <span class="arithmatex">\(u_k\)</span> the 
corresponding control coefficient. In QuanEstimation, different algorithms are invoked to 
update the optimal control coefficients. The control optimization algorithms are<br />
gradient ascent pulse engineering (GRAPE), GRAPE algorithm based on the automatic 
differentiation (auto-GRAPE), particle swarm optimization (PSO), 
differential evolution (DE) and deep deterministic policy gradients (DDPG).</p>
<h3 id="base"><strong>Base</strong><a class="headerlink" href="#base" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.ControlSystem"></a>
  <div class="doc doc-contents first">

  
      <h3 id="quanestimation.ControlSystem--attributes">Attributes<a class="headerlink" href="#quanestimation.ControlSystem--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the control coeffients.<br />
    If set <code>True</code> then the control coefficients and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the control coefficients in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>ctrl0:</strong> <code>list of arrays</code>
    -- Initial guesses of control coefficients.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load control coefficients in the current location.<br />
    If set <code>True</code> then the program will load control coefficients from 
    "controls.csv" file in the current location and use it as the initial 
    control coefficients.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ControlOpt/ControlStruct.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ControlSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the control coeffients.  </span>
<span class="sd">        If set `True` then the control coefficients and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the control coefficients in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **ctrl0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load control coefficients in the current location.  </span>
<span class="sd">        If set `True` then the program will load control coefficients from </span>
<span class="sd">        &quot;controls.csv&quot; file in the current location and use it as the initial </span>
<span class="sd">        control coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span> <span class="o">=</span> <span class="n">savefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="n">ctrl0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">load</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">QJLType_ctrl</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Float64</span><span class="p">]]]</span> 

    <span class="k">def</span><span class="w"> </span><span class="nf">load_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cnum</span><span class="p">,</span> <span class="n">max_episode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;controls.dat&quot;</span><span class="p">):</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;controls.dat&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="s2">&quot;controls&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">:</span>
                <span class="n">controls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_episode</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">controls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnum</span><span class="p">)])</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;controls&quot;</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The dynamics of a density matrix is of the form </span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">            \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">            &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">            \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">        where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">        system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">        operator and corresponding decay rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **tspan:** `array`</span>
<span class="sd">            -- Time length for the evolution.</span>

<span class="sd">        &gt; **rho0:** `matrix`</span>
<span class="sd">            -- Initial state (density matrix).</span>

<span class="sd">        &gt; **H0:** `matrix or list`</span>
<span class="sd">            -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">            independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">        &gt; **dH:** `list`</span>
<span class="sd">            -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">            estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">            parameter.</span>

<span class="sd">        &gt; **Hc:** `list`</span>
<span class="sd">            -- Control Hamiltonians.</span>

<span class="sd">        &gt; **decay:** `list`</span>
<span class="sd">            -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">            decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">            $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">            corresponding decay rate.</span>

<span class="sd">        &gt; **ctrl_bound:** `array`</span>
<span class="sd">            -- Lower and upper bounds of the control coefficients.</span>
<span class="sd">            `ctrl_bound[0]` represents the lower bound of the control coefficients and</span>
<span class="sd">            `ctrl_bound[1]` represents the upper bound of the control coefficients.</span>

<span class="sd">        &gt; **dyn_method:** `string`</span>
<span class="sd">            -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">            &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">            &quot;ode&quot; -- Solving the differential equations directly.  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
        <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

        <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span>  <span class="p">[</span><span class="o">-</span><span class="n">jl</span><span class="o">.</span><span class="n">Inf</span><span class="p">,</span> <span class="n">jl</span><span class="o">.</span><span class="n">Inf</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">jl</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">jl</span><span class="o">.</span><span class="n">Float64</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl0</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl0</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="c1">## TODO</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QJLType_ctrl</span><span class="p">,</span> <span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ctrls</span> <span class="p">]</span><span class="k">for</span> <span class="n">ctrls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;controls.csv&quot;</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">&quot;controls.csv&quot;</span><span class="p">)[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span> <span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

        <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">)</span>
        <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: too many coefficients sequences&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are set to be 0.&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="c1">#### linear interpolation  ####</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">ControlOpt</span><span class="p">(</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span>
            <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> 
            <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">QuanEstimation</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;lindblad&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;RLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;LLD&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for LDtype, supported values are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">LDtype</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
        <span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose HCRB as the objective function. </span>

<span class="sd">        **Notes:** (1) In single parameter estimation, HCRB is equivalent to QFI, please</span>
<span class="sd">        choose QFI as the objective function. (2) GRAPE and auto-GRAPE are not available</span>
<span class="sd">        when the objective function is HCRB. Supported methods are PSO, DE and DDPG.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix` </span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program terminated. In the single-parameter scenario, HCRB is equivalent to QFI. Please choose QFIM as the objective function.&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>  

            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
            <span class="p">)</span>
            <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
            <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **f:** `float`</span>
<span class="sd">            -- The given value of the objective function.</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **method:** `string`</span>
<span class="sd">            -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">            objective function. Options are:  </span>
<span class="sd">            &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">            &quot;forward&quot; -- Forward search from the beginning of time.  </span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">            value of the objective function. Options are:  </span>
<span class="sd">            &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.  </span>
<span class="sd">            &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.  </span>
<span class="sd">            &quot;HCRB&quot; -- Choose HCRB as the objective function.  </span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;binary&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for method, supported values are &#39;binary&#39; and &#39;forward&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">method</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;lindblad&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;savefile is set to be False&quot;</span><span class="p">,</span>
                    <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">f</span>

        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">if</span> <span class="n">M</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">==</span> <span class="s2">&quot;single_para&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Program terminated. In the single-parameter scenario, the HCRB is equivalent to the QFI. Please choose &#39;QFIM&#39; as the objective function.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;QFIM&quot;</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;LLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;RLD&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Please enter the correct values for target and LDtype. Supported target are &#39;QFIM&#39;, &#39;CFIM&#39; and &#39;HCRB&#39;, supported LDtype are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span>
                <span class="p">)</span>

        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.ControlSystem.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.ControlSystem.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.ControlSystem.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.ControlSystem.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/ControlStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ControlSystem.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.ControlSystem.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose HCRB as the objective function. </p>
<p><strong>Notes:</strong> (1) In single parameter estimation, HCRB is equivalent to QFI, please
choose QFI as the objective function. (2) GRAPE and auto-GRAPE are not available
when the objective function is HCRB. Supported methods are PSO, DE and DDPG.</p>
<h4 id="quanestimation.ControlSystem.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.ControlSystem.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code> 
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/ControlStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose HCRB as the objective function. </span>

<span class="sd">    **Notes:** (1) In single parameter estimation, HCRB is equivalent to QFI, please</span>
<span class="sd">    choose QFI as the objective function. (2) GRAPE and auto-GRAPE are not available</span>
<span class="sd">    when the objective function is HCRB. Supported methods are PSO, DE and DDPG.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix` </span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program terminated. In the single-parameter scenario, HCRB is equivalent to QFI. Please choose QFIM as the objective function.&quot;</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ControlSystem.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.ControlSystem.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.ControlSystem.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.ControlSystem.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/ControlStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;RLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;LLD&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for LDtype, supported values are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">LDtype</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
    <span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ControlSystem.dynamics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dynamics</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s1">&#39;expm&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.ControlSystem.dynamics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>The dynamics of a density matrix is of the form </p>
<div class="arithmatex">\[\begin{aligned}
    \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\
    &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}
    \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),
\end{aligned}\]</div>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, H is the Hamiltonian of the 
system, <span class="arithmatex">\(\Gamma_i\)</span> and <span class="arithmatex">\(\gamma_i\)</span> are the <span class="arithmatex">\(i\mathrm{th}\)</span> decay 
operator and corresponding decay rate.</p>
<h4 id="quanestimation.ControlSystem.dynamics--parameters">Parameters<a class="headerlink" href="#quanestimation.ControlSystem.dynamics--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>tspan:</strong> <code>array</code>
    -- Time length for the evolution.</p>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
<p><strong>H0:</strong> <code>matrix or list</code>
    -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-
    independent and a list of length equal to <code>tspan</code> when it is time-dependent.</p>
<p><strong>dH:</strong> <code>list</code>
    -- Derivatives of the free Hamiltonian on the unknown parameters to be 
    estimated. For example, dH[0] is the derivative vector on the first 
    parameter.</p>
<p><strong>Hc:</strong> <code>list</code>
    -- Control Hamiltonians.</p>
<p><strong>decay:</strong> <code>list</code>
    -- Decay operators and the corresponding decay rates. Its input rule is 
    decay=[[<span class="arithmatex">\(\Gamma_1\)</span>, <span class="arithmatex">\(\gamma_1\)</span>], [<span class="arithmatex">\(\Gamma_2\)</span>,<span class="arithmatex">\(\gamma_2\)</span>],...], where <span class="arithmatex">\(\Gamma_1\)</span> 
    <span class="arithmatex">\((\Gamma_2)\)</span> represents the decay operator and <span class="arithmatex">\(\gamma_1\)</span> <span class="arithmatex">\((\gamma_2)\)</span> is the 
    corresponding decay rate.</p>
<p><strong>ctrl_bound:</strong> <code>array</code>
    -- Lower and upper bounds of the control coefficients.
    <code>ctrl_bound[0]</code> represents the lower bound of the control coefficients and
    <code>ctrl_bound[1]</code> represents the upper bound of the control coefficients.</p>
<p><strong>dyn_method:</strong> <code>string</code>
    -- Setting the method for solving the Lindblad dynamics. Options are:<br />
    "expm" (default) -- Matrix exponential.<br />
    "ode" -- Solving the differential equations directly.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/ControlStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The dynamics of a density matrix is of the form </span>

<span class="sd">    \begin{aligned}</span>
<span class="sd">        \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">        &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">        \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">    \end{aligned}</span>

<span class="sd">    where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">    system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">    operator and corresponding decay rate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **tspan:** `array`</span>
<span class="sd">        -- Time length for the evolution.</span>

<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &gt; **H0:** `matrix or list`</span>
<span class="sd">        -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">        independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">    &gt; **dH:** `list`</span>
<span class="sd">        -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">        estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">        parameter.</span>

<span class="sd">    &gt; **Hc:** `list`</span>
<span class="sd">        -- Control Hamiltonians.</span>

<span class="sd">    &gt; **decay:** `list`</span>
<span class="sd">        -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">        decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">        $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">        corresponding decay rate.</span>

<span class="sd">    &gt; **ctrl_bound:** `array`</span>
<span class="sd">        -- Lower and upper bounds of the control coefficients.</span>
<span class="sd">        `ctrl_bound[0]` represents the lower bound of the control coefficients and</span>
<span class="sd">        `ctrl_bound[1]` represents the upper bound of the control coefficients.</span>

<span class="sd">    &gt; **dyn_method:** `string`</span>
<span class="sd">        -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">        &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">        &quot;ode&quot; -- Solving the differential equations directly.  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
    <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

    <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span>  <span class="p">[</span><span class="o">-</span><span class="n">jl</span><span class="o">.</span><span class="n">Inf</span><span class="p">,</span> <span class="n">jl</span><span class="o">.</span><span class="n">Inf</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">jl</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">jl</span><span class="o">.</span><span class="n">Float64</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl0</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl0</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="c1">## TODO</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">QJLType_ctrl</span><span class="p">,</span> <span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ctrls</span> <span class="p">]</span><span class="k">for</span> <span class="n">ctrls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;controls.csv&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">&quot;controls.csv&quot;</span><span class="p">)[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

    <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">)</span>
    <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: too many coefficients sequences&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are set to be 0.&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="c1">#### linear interpolation  ####</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">ControlOpt</span><span class="p">(</span>
        <span class="n">ctrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span>
        <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> 
        <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">QuanEstimation</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
        <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;lindblad&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ControlSystem.mintime" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.ControlSystem.mintime" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Search of the minimum time to reach a given value of the objective function.</p>
<h4 id="quanestimation.ControlSystem.mintime--parameters">Parameters<a class="headerlink" href="#quanestimation.ControlSystem.mintime--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>f:</strong> <code>float</code>
    -- The given value of the objective function.</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>method:</strong> <code>string</code>
    -- Methods for searching the minimum time to reach the given value of the 
    objective function. Options are:<br />
    "binary" (default) -- Binary search (logarithmic search).<br />
    "forward" -- Forward search from the beginning of time.  </p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for searching the minimum time to reach the given 
    value of the objective function. Options are:<br />
    "QFIM" (default) -- Choose QFI (QFIM) as the objective function.<br />
    "CFIM" -- Choose CFI (CFIM) as the objective function.<br />
    "HCRB" -- Choose HCRB as the objective function.  </p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/ControlStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **f:** `float`</span>
<span class="sd">        -- The given value of the objective function.</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **method:** `string`</span>
<span class="sd">        -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">        objective function. Options are:  </span>
<span class="sd">        &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">        &quot;forward&quot; -- Forward search from the beginning of time.  </span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">        value of the objective function. Options are:  </span>
<span class="sd">        &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.  </span>
<span class="sd">        &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.  </span>
<span class="sd">        &quot;HCRB&quot; -- Choose HCRB as the objective function.  </span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;binary&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for method, supported values are &#39;binary&#39; and &#39;forward&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">method</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;lindblad&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;savefile is set to be False&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">f</span>

    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">if</span> <span class="n">M</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">==</span> <span class="s2">&quot;single_para&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Program terminated. In the single-parameter scenario, the HCRB is equivalent to the QFI. Please choose &#39;QFIM&#39; as the objective function.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;QFIM&quot;</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;LLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;RLD&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please enter the correct values for target and LDtype. Supported target are &#39;QFIM&#39;, &#39;CFIM&#39; and &#39;HCRB&#39;, supported LDtype are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span>
            <span class="p">)</span>

    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="control-optimization-with-grape-and-auto-grape"><strong>Control optimization with GRAPE and auto-GRAPE</strong><a class="headerlink" href="#control-optimization-with-grape-and-auto-grape" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.GRAPE_Copt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.ControlOpt.ControlStruct.ControlSystem" href="#quanestimation.ControlSystem">ControlSystem</a></code></p>

  
      <h3 id="quanestimation.GRAPE_Copt--attributes">Attributes<a class="headerlink" href="#quanestimation.GRAPE_Copt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the control coeffients.<br />
    If set <code>True</code> then the control coefficients and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the control coefficients in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>Adam:</strong> <code>bool</code>
    -- Whether or not to use Adam for updating control coefficients.</p>
<p><strong>ctrl0:</strong> <code>list of arrays</code>
    -- Initial guesses of control coefficients.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>epsilon:</strong> <code>float</code>
    -- Learning rate.</p>
<p><strong>beta1:</strong> <code>float</code>
    -- The exponential decay rate for the first moment estimates.</p>
<p><strong>beta2:</strong> <code>float</code>
    -- The exponential decay rate for the second moment estimates.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load control coefficients in the current location.<br />
    If set <code>True</code> then the program will load control coefficients from 
    "controls.csv" file in the current location and use it as the initial 
    control coefficients.</p>
<p><strong>auto:</strong> <code>bool</code>
    -- Whether or not to invoke automatic differentiation algorithm to evaluate<br />
    the gradient. If set <code>True</code> then the gradient will be calculated with 
    automatic differentiation algorithm otherwise it will be calculated 
    using analytical method.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ControlOpt/GRAPE_Copt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GRAPE_Copt</span><span class="p">(</span><span class="n">Control</span><span class="o">.</span><span class="n">ControlSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the control coeffients.  </span>
<span class="sd">        If set `True` then the control coefficients and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the control coefficients in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **Adam:** `bool`</span>
<span class="sd">        -- Whether or not to use Adam for updating control coefficients.</span>

<span class="sd">    &gt; **ctrl0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **epsilon:** `float`</span>
<span class="sd">        -- Learning rate.</span>

<span class="sd">    &gt; **beta1:** `float`</span>
<span class="sd">        -- The exponential decay rate for the first moment estimates.</span>

<span class="sd">    &gt; **beta2:** `float`</span>
<span class="sd">        -- The exponential decay rate for the second moment estimates.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load control coefficients in the current location.  </span>
<span class="sd">        If set `True` then the program will load control coefficients from </span>
<span class="sd">        &quot;controls.csv&quot; file in the current location and use it as the initial </span>
<span class="sd">        control coefficients.</span>

<span class="sd">    &gt; **auto:** `bool`</span>
<span class="sd">        -- Whether or not to invoke automatic differentiation algorithm to evaluate  </span>
<span class="sd">        the gradient. If set `True` then the gradient will be calculated with </span>
<span class="sd">        automatic differentiation algorithm otherwise it will be calculated </span>
<span class="sd">        using analytical method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">Adam</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ctrl0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">beta1</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
        <span class="n">beta2</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Control</span><span class="o">.</span><span class="n">ControlSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span> <span class="o">=</span> <span class="n">Adam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">=</span> <span class="n">beta1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">=</span> <span class="n">beta2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto</span> <span class="o">=</span> <span class="n">auto</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GRAPE is not available when the length of each control is not </span><span class="se">\</span>
<span class="s2">                               equal to the length of time, and is replaced by auto-GRAPE.&quot;</span><span class="p">,</span>
                               <span class="ne">DeprecationWarning</span><span class="p">)</span>
                <span class="c1">#### call autoGRAPE automatically ####</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;GRAPE is only available when LDtype is SLD.&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GRAPE is not available when the length of each control is not </span><span class="se">\</span>
<span class="s2">                               equal to the length of time, and is replaced by auto-GRAPE.&quot;</span><span class="p">,</span>
                               <span class="ne">DeprecationWarning</span><span class="p">)</span>
                <span class="c1">#### call autoGRAPE automatically ####</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        GRAPE and auto-GRAPE are not available when the objective function is HCRB. </span>
<span class="sd">        Supported methods are PSO, DE and DDPG.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;GRAPE and auto-GRAPE are not available when the objective function is HCRB. Supported methods are &#39;PSO&#39;, &#39;DE&#39; and &#39;DDPG&#39;.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **f:** `float`</span>
<span class="sd">            -- The given value of the objective function.</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **method:** `string`</span>
<span class="sd">            -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">            objective function. Options are:  </span>
<span class="sd">            &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">            &quot;forward&quot; -- Forward search from the beginning of time.  </span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">            value of the objective function. Options are:  </span>
<span class="sd">            &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.  </span>
<span class="sd">            &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.  </span>
<span class="sd">            &quot;HCRB&quot; -- Choose HCRB as the objective function.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;GRAPE and auto-GRAPE are not available when the objective function is HCRB. Supported methods are &#39;PSO&#39;, &#39;DE&#39; and &#39;DDPG&#39;.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.GRAPE_Copt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.GRAPE_Copt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.GRAPE_Copt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.GRAPE_Copt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/GRAPE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GRAPE is not available when the length of each control is not </span><span class="se">\</span>
<span class="s2">                           equal to the length of time, and is replaced by auto-GRAPE.&quot;</span><span class="p">,</span>
                           <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="c1">#### call autoGRAPE automatically ####</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.GRAPE_Copt.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.GRAPE_Copt.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>GRAPE and auto-GRAPE are not available when the objective function is HCRB. 
Supported methods are PSO, DE and DDPG.</p>
<h4 id="quanestimation.GRAPE_Copt.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.GRAPE_Copt.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/GRAPE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GRAPE and auto-GRAPE are not available when the objective function is HCRB. </span>
<span class="sd">    Supported methods are PSO, DE and DDPG.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="s2">&quot;GRAPE and auto-GRAPE are not available when the objective function is HCRB. Supported methods are &#39;PSO&#39;, &#39;DE&#39; and &#39;DDPG&#39;.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.GRAPE_Copt.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.GRAPE_Copt.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.GRAPE_Copt.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.GRAPE_Copt.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/GRAPE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GRAPE is not available when the length of each control is not </span><span class="se">\</span>
<span class="s2">                           equal to the length of time, and is replaced by auto-GRAPE.&quot;</span><span class="p">,</span>
                           <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="c1">#### call autoGRAPE automatically ####</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;GRAPE is only available when LDtype is SLD.&quot;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.GRAPE_Copt.mintime" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.GRAPE_Copt.mintime" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Search of the minimum time to reach a given value of the objective function.</p>
<h4 id="quanestimation.GRAPE_Copt.mintime--parameters">Parameters<a class="headerlink" href="#quanestimation.GRAPE_Copt.mintime--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>f:</strong> <code>float</code>
    -- The given value of the objective function.</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>method:</strong> <code>string</code>
    -- Methods for searching the minimum time to reach the given value of the 
    objective function. Options are:<br />
    "binary" (default) -- Binary search (logarithmic search).<br />
    "forward" -- Forward search from the beginning of time.  </p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for searching the minimum time to reach the given 
    value of the objective function. Options are:<br />
    "QFIM" (default) -- Choose QFI (QFIM) as the objective function.<br />
    "CFIM" -- Choose CFI (CFIM) as the objective function.<br />
    "HCRB" -- Choose HCRB as the objective function.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/GRAPE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **f:** `float`</span>
<span class="sd">        -- The given value of the objective function.</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **method:** `string`</span>
<span class="sd">        -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">        objective function. Options are:  </span>
<span class="sd">        &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">        &quot;forward&quot; -- Forward search from the beginning of time.  </span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">        value of the objective function. Options are:  </span>
<span class="sd">        &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.  </span>
<span class="sd">        &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.  </span>
<span class="sd">        &quot;HCRB&quot; -- Choose HCRB as the objective function.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;GRAPE and auto-GRAPE are not available when the objective function is HCRB. Supported methods are &#39;PSO&#39;, &#39;DE&#39; and &#39;DDPG&#39;.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">autoGRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">GRAPE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="control-optimization-with-pso"><strong>Control Optimization with PSO</strong><a class="headerlink" href="#control-optimization-with-pso" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.PSO_Copt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.ControlOpt.ControlStruct.ControlSystem" href="#quanestimation.ControlSystem">ControlSystem</a></code></p>

  
      <h3 id="quanestimation.PSO_Copt--attributes">Attributes<a class="headerlink" href="#quanestimation.PSO_Copt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the control coeffients.<br />
    If set <code>True</code> then the control coefficients and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the control coefficients in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of particles.</p>
<p><strong>ctrl0:</strong> <code>list of arrays</code>
    -- Initial guesses of control coefficients.</p>
<p><strong>max_episode:</strong> <code>int or list</code>
    -- If it is an integer, for example max_episode=1000, it means the 
    program will continuously run 1000 episodes. However, if it is an
    array, for example max_episode=[1000,100], the program will run 
    1000 episodes in total but replace control coefficients of all
    the particles with global best every 100 episodes.</p>
<p><strong>c0:</strong> <code>float</code>
    -- The damping factor that assists convergence, also known as inertia weight.</p>
<p><strong>c1:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to its best previous 
    position, also known as cognitive learning factor.</p>
<p><strong>c2:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to the best position<br />
    in the neighborhood, also known as social learning factor.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load control coefficients in the current location.<br />
    If set <code>True</code> then the program will load control coefficients from 
    "controls.csv" file in the current location and use it as the initial 
    control coefficients.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ControlOpt/PSO_Copt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PSO_Copt</span><span class="p">(</span><span class="n">Control</span><span class="o">.</span><span class="n">ControlSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the control coeffients.  </span>
<span class="sd">        If set `True` then the control coefficients and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the control coefficients in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of particles.</span>

<span class="sd">    &gt; **ctrl0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **max_episode:** `int or list`</span>
<span class="sd">        -- If it is an integer, for example max_episode=1000, it means the </span>
<span class="sd">        program will continuously run 1000 episodes. However, if it is an</span>
<span class="sd">        array, for example max_episode=[1000,100], the program will run </span>
<span class="sd">        1000 episodes in total but replace control coefficients of all</span>
<span class="sd">        the particles with global best every 100 episodes.</span>

<span class="sd">    &gt; **c0:** `float`</span>
<span class="sd">        -- The damping factor that assists convergence, also known as inertia weight.</span>

<span class="sd">    &gt; **c1:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to its best previous </span>
<span class="sd">        position, also known as cognitive learning factor.</span>

<span class="sd">    &gt; **c2:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to the best position  </span>
<span class="sd">        in the neighborhood, also known as social learning factor.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load control coefficients in the current location.  </span>
<span class="sd">        If set `True` then the program will load control coefficients from </span>
<span class="sd">        &quot;controls.csv&quot; file in the current location and use it as the initial </span>
<span class="sd">        control coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">ctrl0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">c2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Control</span><span class="o">.</span><span class="n">ControlSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>

        <span class="n">is_int</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span> <span class="k">if</span> <span class="n">is_int</span> <span class="k">else</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="n">max_episode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span> <span class="o">=</span> <span class="n">c0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose HCRB as the objective function. </span>

<span class="sd">        **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">        QFI as the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **f:** `float`</span>
<span class="sd">            -- The given value of the objective function.</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **method:** `string`</span>
<span class="sd">            -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">            objective function. Options are:  </span>
<span class="sd">            &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">            &quot;forward&quot; -- Forward search from the beginning of time.</span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">            value of the objective function. Options are:  </span>
<span class="sd">            &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.  </span>
<span class="sd">            &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.  </span>
<span class="sd">            &quot;HCRB&quot; -- Choose HCRB as the objective function.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Copt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Copt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.PSO_Copt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Copt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/PSO_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Copt.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Copt.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose HCRB as the objective function. </p>
<p><strong>Note:</strong> in single parameter estimation, HCRB is equivalent to QFI, please choose 
QFI as the objective function.</p>
<h4 id="quanestimation.PSO_Copt.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Copt.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/PSO_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose HCRB as the objective function. </span>

<span class="sd">    **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">    QFI as the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Copt.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.PSO_Copt.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.PSO_Copt.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Copt.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/PSO_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Copt.mintime" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.PSO_Copt.mintime" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Search of the minimum time to reach a given value of the objective function.</p>
<h4 id="quanestimation.PSO_Copt.mintime--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Copt.mintime--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>f:</strong> <code>float</code>
    -- The given value of the objective function.</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>method:</strong> <code>string</code>
    -- Methods for searching the minimum time to reach the given value of the 
    objective function. Options are:<br />
    "binary" (default) -- Binary search (logarithmic search).<br />
    "forward" -- Forward search from the beginning of time.</p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for searching the minimum time to reach the given 
    value of the objective function. Options are:<br />
    "QFIM" (default) -- Choose QFI (QFIM) as the objective function.<br />
    "CFIM" -- Choose CFI (CFIM) as the objective function.<br />
    "HCRB" -- Choose HCRB as the objective function.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/PSO_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **f:** `float`</span>
<span class="sd">        -- The given value of the objective function.</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **method:** `string`</span>
<span class="sd">        -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">        objective function. Options are:  </span>
<span class="sd">        &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">        &quot;forward&quot; -- Forward search from the beginning of time.</span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">        value of the objective function. Options are:  </span>
<span class="sd">        &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.  </span>
<span class="sd">        &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.  </span>
<span class="sd">        &quot;HCRB&quot; -- Choose HCRB as the objective function.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="control-optimization-de"><strong>Control Optimization DE</strong><a class="headerlink" href="#control-optimization-de" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.DE_Copt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.ControlOpt.ControlStruct.ControlSystem" href="#quanestimation.ControlSystem">ControlSystem</a></code></p>

  
      <h3 id="quanestimation.DE_Copt--attributes">Attributes<a class="headerlink" href="#quanestimation.DE_Copt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    --Whether or not to save all the control coeffients.<br />
    If set <code>True</code> then the control coefficients and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the control coefficients in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of populations.</p>
<p><strong>ctrl0:</strong> list of arrays
    -- Initial guesses of control coefficients.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>c:</strong> <code>float</code>
    -- Mutation constant.</p>
<p><strong>cr:</strong> <code>float</code>
    -- Crossover constant.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load control coefficients in the current location.<br />
    If set <code>True</code> then the program will load control coefficients from 
    "controls.csv" file in the current location and use it as the initial 
    control coefficients.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ControlOpt/DE_Copt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DE_Copt</span><span class="p">(</span><span class="n">Control</span><span class="o">.</span><span class="n">ControlSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        --Whether or not to save all the control coeffients.  </span>
<span class="sd">        If set `True` then the control coefficients and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the control coefficients in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of populations.</span>

<span class="sd">    &gt; **ctrl0:** list of arrays</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **c:** `float`</span>
<span class="sd">        -- Mutation constant.</span>

<span class="sd">    &gt; **cr:** `float`</span>
<span class="sd">        -- Crossover constant.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load control coefficients in the current location.  </span>
<span class="sd">        If set `True` then the program will load control coefficients from </span>
<span class="sd">        &quot;controls.csv&quot; file in the current location and use it as the initial </span>
<span class="sd">        control coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">ctrl0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">cr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Control</span><span class="o">.</span><span class="n">ControlSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span> <span class="o">=</span> <span class="n">cr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose HCRB as the objective function. </span>

<span class="sd">        **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">        QFI as the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **f:** `float`</span>
<span class="sd">            -- The given value of the objective function.</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **method:** `string`</span>
<span class="sd">            -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">            objective function. Options are:  </span>
<span class="sd">            &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">            &quot;forward&quot; -- Forward search from the beginning of time.</span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">            value of the objective function. Options are:&lt;br&gt;</span>
<span class="sd">            &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.&lt;br&gt;</span>
<span class="sd">            &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.&lt;br&gt;</span>
<span class="sd">            &quot;HCRB&quot; -- Choose HCRB as the objective function.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Copt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Copt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.DE_Copt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Copt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/DE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Copt.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Copt.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose HCRB as the objective function. </p>
<p><strong>Note:</strong> in single parameter estimation, HCRB is equivalent to QFI, please choose 
QFI as the objective function.</p>
<h4 id="quanestimation.DE_Copt.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Copt.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/DE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose HCRB as the objective function. </span>

<span class="sd">    **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">    QFI as the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Copt.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.DE_Copt.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.DE_Copt.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Copt.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/DE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Copt.mintime" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.DE_Copt.mintime" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Search of the minimum time to reach a given value of the objective function.</p>
<h4 id="quanestimation.DE_Copt.mintime--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Copt.mintime--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>f:</strong> <code>float</code>
    -- The given value of the objective function.</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>method:</strong> <code>string</code>
    -- Methods for searching the minimum time to reach the given value of the 
    objective function. Options are:<br />
    "binary" (default) -- Binary search (logarithmic search).<br />
    "forward" -- Forward search from the beginning of time.</p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for searching the minimum time to reach the given 
    value of the objective function. Options are:<br>
    "QFIM" (default) -- Choose QFI (QFIM) as the objective function.<br>
    "CFIM" -- Choose CFI (CFIM) as the objective function.<br>
    "HCRB" -- Choose HCRB as the objective function.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ControlOpt/DE_Copt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mintime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search of the minimum time to reach a given value of the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **f:** `float`</span>
<span class="sd">        -- The given value of the objective function.</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **method:** `string`</span>
<span class="sd">        -- Methods for searching the minimum time to reach the given value of the </span>
<span class="sd">        objective function. Options are:  </span>
<span class="sd">        &quot;binary&quot; (default) -- Binary search (logarithmic search).  </span>
<span class="sd">        &quot;forward&quot; -- Forward search from the beginning of time.</span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">        value of the objective function. Options are:&lt;br&gt;</span>
<span class="sd">        &quot;QFIM&quot; (default) -- Choose QFI (QFIM) as the objective function.&lt;br&gt;</span>
<span class="sd">        &quot;CFIM&quot; -- Choose CFI (CFIM) as the objective function.&lt;br&gt;</span>
<span class="sd">        &quot;HCRB&quot; -- Choose HCRB as the objective function.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mintime</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><hr />
<h2 id="state-optimization"><strong>State Optimization</strong><a class="headerlink" href="#state-optimization" title="Permanent link">&para;</a></h2>
<p>The probe state is expanded as <span class="arithmatex">\(|\psi\rangle=\sum_i c_i|i\rangle\)</span> in a specific
basis, i.e., <span class="arithmatex">\(\{|i\rangle\}\)</span>. In state optimization, the search of the
optimal probe states is equal to search of the normalized complex coefficients
<span class="arithmatex">\(\{c_i\}\)</span>. In QuanEstimation, the state optimization algorithms are 
automatic differentiation (AD), reverse iterative (RI) algorithm, particle swarm 
optimization (PSO), differential evolution (DE), deep deterministic policy gradients 
(DDPG) and Nelder-Mead (NM).</p>
<h3 id="base_1"><strong>Base</strong><a class="headerlink" href="#base_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.StateSystem"></a>
  <div class="doc doc-contents first">

  
      <h3 id="quanestimation.StateSystem--attributes">Attributes<a class="headerlink" href="#quanestimation.StateSystem--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong>  <code>bool</code>
    -- Whether or not to save all the states.
    If set <code>True</code> then the states and the values of the objective function 
    obtained in all episodes will be saved during the training. If set <code>False</code> 
    the state in the final episode and the values of the objective function in 
    all episodes will be saved.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load states in the current location.
    If set <code>True</code> then the program will load state from "states.csv"
    file in the current location and use it as the initial state.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/StateOpt/StateStruct.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StateSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:**  `bool`</span>
<span class="sd">        -- Whether or not to save all the states.</span>
<span class="sd">        If set `True` then the states and the values of the objective function </span>
<span class="sd">        obtained in all episodes will be saved during the training. If set `False` </span>
<span class="sd">        the state in the final episode and the values of the objective function in </span>
<span class="sd">        all episodes will be saved.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load states in the current location.</span>
<span class="sd">        If set `True` then the program will load state from &quot;states.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span> <span class="o">=</span> <span class="n">savefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">psi0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">psi0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

        <span class="k">if</span> <span class="n">load</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;states.npy&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;states.npy&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_episode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;states.dat&quot;</span><span class="p">):</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;states.dat&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">:</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_episode</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The dynamics of a density matrix is of the form </span>

<span class="sd">        \begin{align}</span>
<span class="sd">        \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">        &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">        \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">        \end{align}</span>

<span class="sd">        where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">        system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">        operator and corresponding decay rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **tspan:** `array`</span>
<span class="sd">            -- Time length for the evolution.</span>

<span class="sd">        &gt; **H0:** `matrix or list`</span>
<span class="sd">            -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">            independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">        &gt; **dH:** `list`</span>
<span class="sd">            -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">            estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">            parameter.</span>

<span class="sd">        &gt; **Hc:** `list`</span>
<span class="sd">            -- Control Hamiltonians.</span>

<span class="sd">        &gt; **ctrl:** `list of arrays`</span>
<span class="sd">            -- Control coefficients.</span>

<span class="sd">        &gt; **decay:** `list`</span>
<span class="sd">            -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">            decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">            $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">            corresponding decay rate.</span>

<span class="sd">        &gt; **dyn_method:** `string`</span>
<span class="sd">            -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">            &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">            &quot;ode&quot; -- Solving the differential equations directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>

        <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
        <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

        <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">ctrl</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
            <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: </span><span class="se">\</span>
<span class="s2">                                 too many coefficients sequences.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians </span><span class="se">\</span>
<span class="s2">                               but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are</span><span class="se">\</span>
<span class="s2">                               set to be 0.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                    <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Htot</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H0</span><span class="p">)):</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="c1">#### linear interpolation  ####</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                        <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">QJLType_psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">psi0</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">])</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">)))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateOpt</span><span class="p">(</span><span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
                <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The parameterization of a state is</span>
<span class="sd">        \begin{align}</span>
<span class="sd">        \rho=\sum_i K_i\rho_0K_i^{\dagger},</span>
<span class="sd">        \end{align} </span>

<span class="sd">        where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **K:** `list`</span>
<span class="sd">            -- Kraus operators.</span>

<span class="sd">        &gt; **dK:** `list`</span>
<span class="sd">            -- Derivatives of the Kraus operators on the unknown parameters to be </span>
<span class="sd">            estimated. For example, dK[0] is the derivative vector on the first </span>
<span class="sd">            parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">k_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
        <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">=</span> <span class="n">para_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">K</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">para_num</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_num</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">psi0</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>  <span class="c1"># Initial state (an array)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">]</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">psi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateOpt</span><span class="p">(</span><span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>
        <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:</span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).</span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).</span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;RLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;LLD&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for LDtype, supported values are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">LDtype</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
        <span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">))</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose HCRB as the objective function. </span>

<span class="sd">        **Notes:** (1) In single parameter estimation, HCRB is equivalent to QFI, please  </span>
<span class="sd">        choose QFI as the objective function. (2) GRAPE and auto-GRAPE are not available</span>
<span class="sd">        when the objective function is HCRB. Supported methods are PSO, DE and DDPG.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix` </span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program terminated. In the single-parameter scenario, the HCRB is equivalent to the QFI. Please choose &#39;QFIM&#39; as the objective function&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;In single parameter scenario, HCRB is equivalent to QFI. Please choose QFIM as the target function for control optimization&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Supported type of dynamics are Lindblad and Kraus.&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.StateSystem.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.StateSystem.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.StateSystem.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.StateSystem.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/StateStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.StateSystem.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.StateSystem.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose HCRB as the objective function. </p>
<p><strong>Notes:</strong> (1) In single parameter estimation, HCRB is equivalent to QFI, please<br />
choose QFI as the objective function. (2) GRAPE and auto-GRAPE are not available
when the objective function is HCRB. Supported methods are PSO, DE and DDPG.</p>
<h4 id="quanestimation.StateSystem.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.StateSystem.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code> 
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/StateStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose HCRB as the objective function. </span>

<span class="sd">    **Notes:** (1) In single parameter estimation, HCRB is equivalent to QFI, please  </span>
<span class="sd">    choose QFI as the objective function. (2) GRAPE and auto-GRAPE are not available</span>
<span class="sd">    when the objective function is HCRB. Supported methods are PSO, DE and DDPG.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix` </span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program terminated. In the single-parameter scenario, the HCRB is equivalent to the QFI. Please choose &#39;QFIM&#39; as the objective function&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;In single parameter scenario, HCRB is equivalent to QFI. Please choose QFIM as the target function for control optimization&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Supported type of dynamics are Lindblad and Kraus.&quot;</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.StateSystem.Kraus" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">Kraus</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">)</span></code>

<a href="#quanestimation.StateSystem.Kraus" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>The parameterization of a state is
\begin{align}
\rho=\sum_i K_i\rho_0K_i^{\dagger},
\end{align} </p>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, <span class="arithmatex">\(K_i\)</span> is the Kraus operator.</p>
<h4 id="quanestimation.StateSystem.Kraus--parameters">Parameters<a class="headerlink" href="#quanestimation.StateSystem.Kraus--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>K:</strong> <code>list</code>
    -- Kraus operators.</p>
<p><strong>dK:</strong> <code>list</code>
    -- Derivatives of the Kraus operators on the unknown parameters to be 
    estimated. For example, dK[0] is the derivative vector on the first 
    parameter.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/StateStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The parameterization of a state is</span>
<span class="sd">    \begin{align}</span>
<span class="sd">    \rho=\sum_i K_i\rho_0K_i^{\dagger},</span>
<span class="sd">    \end{align} </span>

<span class="sd">    where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **K:** `list`</span>
<span class="sd">        -- Kraus operators.</span>

<span class="sd">    &gt; **dK:** `list`</span>
<span class="sd">        -- Derivatives of the Kraus operators on the unknown parameters to be </span>
<span class="sd">        estimated. For example, dK[0] is the derivative vector on the first </span>
<span class="sd">        parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">k_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
    <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">=</span> <span class="n">para_num</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">K</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">para_num</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_num</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">psi0</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>  <span class="c1"># Initial state (an array)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">]</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">psi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateOpt</span><span class="p">(</span><span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>
    <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.StateSystem.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.StateSystem.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.StateSystem.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.StateSystem.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/StateStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:</span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).</span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).</span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;RLD&quot;</span> <span class="ow">and</span> <span class="n">LDtype</span> <span class="o">!=</span> <span class="s2">&quot;LLD&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for LDtype, supported values are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">LDtype</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
    <span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.StateSystem.dynamics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dynamics</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s1">&#39;expm&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.StateSystem.dynamics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>The dynamics of a density matrix is of the form </p>
<div class="arithmatex">\[\begin{align}
\partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\
&amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}
\left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),
\end{align}\]</div>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, H is the Hamiltonian of the 
system, <span class="arithmatex">\(\Gamma_i\)</span> and <span class="arithmatex">\(\gamma_i\)</span> are the <span class="arithmatex">\(i\mathrm{th}\)</span> decay 
operator and corresponding decay rate.</p>
<h4 id="quanestimation.StateSystem.dynamics--parameters">Parameters<a class="headerlink" href="#quanestimation.StateSystem.dynamics--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>tspan:</strong> <code>array</code>
    -- Time length for the evolution.</p>
<p><strong>H0:</strong> <code>matrix or list</code>
    -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-
    independent and a list of length equal to <code>tspan</code> when it is time-dependent.</p>
<p><strong>dH:</strong> <code>list</code>
    -- Derivatives of the free Hamiltonian on the unknown parameters to be 
    estimated. For example, dH[0] is the derivative vector on the first 
    parameter.</p>
<p><strong>Hc:</strong> <code>list</code>
    -- Control Hamiltonians.</p>
<p><strong>ctrl:</strong> <code>list of arrays</code>
    -- Control coefficients.</p>
<p><strong>decay:</strong> <code>list</code>
    -- Decay operators and the corresponding decay rates. Its input rule is 
    decay=[[<span class="arithmatex">\(\Gamma_1\)</span>, <span class="arithmatex">\(\gamma_1\)</span>], [<span class="arithmatex">\(\Gamma_2\)</span>,<span class="arithmatex">\(\gamma_2\)</span>],...], where <span class="arithmatex">\(\Gamma_1\)</span> 
    <span class="arithmatex">\((\Gamma_2)\)</span> represents the decay operator and <span class="arithmatex">\(\gamma_1\)</span> <span class="arithmatex">\((\gamma_2)\)</span> is the 
    corresponding decay rate.</p>
<p><strong>dyn_method:</strong> <code>string</code>
    -- Setting the method for solving the Lindblad dynamics. Options are:<br />
    "expm" (default) -- Matrix exponential.<br />
    "ode" -- Solving the differential equations directly.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/StateStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The dynamics of a density matrix is of the form </span>

<span class="sd">    \begin{align}</span>
<span class="sd">    \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">    &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">    \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">    \end{align}</span>

<span class="sd">    where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">    system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">    operator and corresponding decay rate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **tspan:** `array`</span>
<span class="sd">        -- Time length for the evolution.</span>

<span class="sd">    &gt; **H0:** `matrix or list`</span>
<span class="sd">        -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">        independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">    &gt; **dH:** `list`</span>
<span class="sd">        -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">        estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">        parameter.</span>

<span class="sd">    &gt; **Hc:** `list`</span>
<span class="sd">        -- Control Hamiltonians.</span>

<span class="sd">    &gt; **ctrl:** `list of arrays`</span>
<span class="sd">        -- Control coefficients.</span>

<span class="sd">    &gt; **decay:** `list`</span>
<span class="sd">        -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">        decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">        $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">        corresponding decay rate.</span>

<span class="sd">    &gt; **dyn_method:** `string`</span>
<span class="sd">        -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">        &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">        &quot;ode&quot; -- Solving the differential equations directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>

    <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
    <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

    <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">ctrl</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
        <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: </span><span class="se">\</span>
<span class="s2">                             too many coefficients sequences.&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians </span><span class="se">\</span>
<span class="s2">                           but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are</span><span class="se">\</span>
<span class="s2">                           set to be 0.&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                <span class="n">ctrl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Htot</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H0</span><span class="p">)):</span>
                    <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="c1">#### linear interpolation  ####</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                    <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                    <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">QJLType_psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">psi0</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">])</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">)))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateOpt</span><span class="p">(</span><span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="state-optimization-with-ad"><strong>State optimization with AD</strong><a class="headerlink" href="#state-optimization-with-ad" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.AD_Sopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.StateOpt.StateStruct.StateSystem" href="#quanestimation.StateSystem">StateSystem</a></code></p>

  
      <h3 id="quanestimation.AD_Sopt--attributes">Attributes<a class="headerlink" href="#quanestimation.AD_Sopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the states.<br />
    If set <code>True</code> then the states and the values of the objective function 
    obtained in all episodes will be saved during the training. If set <code>False</code> 
    the state in the final episode and the values of the objective function in 
    all episodes will be saved.</p>
<p><strong>Adam:</strong> <code>bool</code>
    -- Whether or not to use Adam for updating states.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>epsilon:</strong> <code>float</code>
    -- Learning rate.</p>
<p><strong>beta1:</strong> <code>float</code>
    -- The exponential decay rate for the first moment estimates.</p>
<p><strong>beta2:</strong> <code>float</code>
    -- The exponential decay rate for the second moment estimates.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load states in the current location.<br />
    If set <code>True</code> then the program will load state from "states.csv"
    file in the current location and use it as the initial state.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/StateOpt/AD_Sopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AD_Sopt</span><span class="p">(</span><span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the states.  </span>
<span class="sd">        If set `True` then the states and the values of the objective function </span>
<span class="sd">        obtained in all episodes will be saved during the training. If set `False` </span>
<span class="sd">        the state in the final episode and the values of the objective function in </span>
<span class="sd">        all episodes will be saved.</span>

<span class="sd">    &gt; **Adam:** `bool`</span>
<span class="sd">        -- Whether or not to use Adam for updating states.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **epsilon:** `float`</span>
<span class="sd">        -- Learning rate.</span>

<span class="sd">    &gt; **beta1:** `float`</span>
<span class="sd">        -- The exponential decay rate for the first moment estimates.</span>

<span class="sd">    &gt; **beta2:** `float`</span>
<span class="sd">        -- The exponential decay rate for the second moment estimates.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load states in the current location.  </span>
<span class="sd">        If set `True` then the program will load state from &quot;states.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">Adam</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">psi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">beta1</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
        <span class="n">beta2</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span> <span class="o">=</span> <span class="n">Adam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">=</span> <span class="n">beta1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">=</span> <span class="n">beta2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vt</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        AD is not available when the objective function is HCRB. </span>
<span class="sd">        Supported methods are PSO, DE, DDPG and NM.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;AD is not available when the objective function is HCRB. Supported methods are &#39;PSO&#39;, &#39;DE&#39;, &#39;NM&#39; and &#39;DDPG&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.AD_Sopt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.AD_Sopt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.AD_Sopt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.AD_Sopt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/AD_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.AD_Sopt.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.AD_Sopt.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>AD is not available when the objective function is HCRB. 
Supported methods are PSO, DE, DDPG and NM.</p>
<h4 id="quanestimation.AD_Sopt.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.AD_Sopt.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/AD_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    AD is not available when the objective function is HCRB. </span>
<span class="sd">    Supported methods are PSO, DE, DDPG and NM.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="s2">&quot;AD is not available when the objective function is HCRB. Supported methods are &#39;PSO&#39;, &#39;DE&#39;, &#39;NM&#39; and &#39;DDPG&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.AD_Sopt.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.AD_Sopt.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.AD_Sopt.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.AD_Sopt.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/AD_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="state-optimization-with-ri"><strong>State optimization with RI</strong><a class="headerlink" href="#state-optimization-with-ri" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.RI_Sopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.StateOpt.StateStruct.StateSystem" href="#quanestimation.StateSystem">StateSystem</a></code></p>

  
      <h3 id="quanestimation.RI_Sopt--attributes">Attributes<a class="headerlink" href="#quanestimation.RI_Sopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong>  <code>bool</code>
    -- Whether or not to save all the states.<br />
    If set <code>True</code> then the states and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the state in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load states in the current location.<br />
    If set <code>True</code> then the program will load state from "states.csv"
    file in the current location and use it as the initial state.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/StateOpt/RI_Sopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RI_Sopt</span><span class="p">(</span><span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:**  `bool`</span>
<span class="sd">        -- Whether or not to save all the states.  </span>
<span class="sd">        If set `True` then the states and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the state in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load states in the current location.  </span>
<span class="sd">        If set `True` then the program will load state from &quot;states.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">psi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI as the objective function. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Only SLD can</span>
<span class="sd">            is available here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">RI</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only the parameterization with Kraus operators is available.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only SLD is available.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFIM as the objective function. </span>

<span class="sd">        **Note:** CFIM is not available.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **M:** `list`</span>
<span class="sd">            -- POVM.</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CFIM is not available.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose HCRB as the objective function. </span>

<span class="sd">        **Note:** Here HCRB is not available.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;HCRB is not available.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.RI_Sopt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.RI_Sopt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFIM as the objective function. </p>
<p><strong>Note:</strong> CFIM is not available.</p>
<h4 id="quanestimation.RI_Sopt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.RI_Sopt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>M:</strong> <code>list</code>
    -- POVM.</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/RI_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFIM as the objective function. </span>

<span class="sd">    **Note:** CFIM is not available.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **M:** `list`</span>
<span class="sd">        -- POVM.</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CFIM is not available.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.RI_Sopt.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.RI_Sopt.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose HCRB as the objective function. </p>
<p><strong>Note:</strong> Here HCRB is not available.</p>
<h4 id="quanestimation.RI_Sopt.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.RI_Sopt.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/RI_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose HCRB as the objective function. </span>

<span class="sd">    **Note:** Here HCRB is not available.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;HCRB is not available.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.RI_Sopt.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.RI_Sopt.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI as the objective function. </p>
<h4 id="quanestimation.RI_Sopt.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.RI_Sopt.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Only SLD can
    is available here.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/RI_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI as the objective function. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Only SLD can</span>
<span class="sd">        is available here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">RI</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only the parameterization with Kraus operators is available.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only SLD is available.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="state-optimization-with-pso"><strong>State Optimization with PSO</strong><a class="headerlink" href="#state-optimization-with-pso" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.PSO_Sopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.StateOpt.StateStruct.StateSystem" href="#quanestimation.StateSystem">StateSystem</a></code></p>

  
      <h3 id="quanestimation.PSO_Sopt--attributes">Attributes<a class="headerlink" href="#quanestimation.PSO_Sopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong>  <code>bool</code>
    -- Whether or not to save all the states.<br />
    If set <code>True</code> then the states and the values of the objective function 
    obtained in all episodes will be saved during the training. If set <code>False</code> 
    the state in the final episode and the values of the objective function 
    in all episodes will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of particles.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>max_episode:</strong> <code>int or list</code>
    -- If it is an integer, for example max_episode=1000, it means the 
    program will continuously run 1000 episodes. However, if it is an
    array, for example max_episode=[1000,100], the program will run 
    1000 episodes in total but replace states of all  the particles 
    with global best every 100 episodes.</p>
<p><strong>c0:</strong> <code>float</code>
    -- The damping factor that assists convergence, also known as inertia weight.</p>
<p><strong>c1:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to its best previous 
    position, also known as cognitive learning factor.</p>
<p><strong>c2:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to the best position<br />
    in the neighborhood, also known as social learning factor.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load states in the current location.
    If set <code>True</code> then the program will load state from "states.csv"
    file in the current location and use it as the initial state.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/StateOpt/PSO_Sopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PSO_Sopt</span><span class="p">(</span><span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:**  `bool`</span>
<span class="sd">        -- Whether or not to save all the states.  </span>
<span class="sd">        If set `True` then the states and the values of the objective function </span>
<span class="sd">        obtained in all episodes will be saved during the training. If set `False` </span>
<span class="sd">        the state in the final episode and the values of the objective function </span>
<span class="sd">        in all episodes will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of particles.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **max_episode:** `int or list`</span>
<span class="sd">        -- If it is an integer, for example max_episode=1000, it means the </span>
<span class="sd">        program will continuously run 1000 episodes. However, if it is an</span>
<span class="sd">        array, for example max_episode=[1000,100], the program will run </span>
<span class="sd">        1000 episodes in total but replace states of all  the particles </span>
<span class="sd">        with global best every 100 episodes.</span>

<span class="sd">    &gt; **c0:** `float`</span>
<span class="sd">        -- The damping factor that assists convergence, also known as inertia weight.</span>

<span class="sd">    &gt; **c1:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to its best previous </span>
<span class="sd">        position, also known as cognitive learning factor.</span>

<span class="sd">    &gt; **c2:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to the best position  </span>
<span class="sd">        in the neighborhood, also known as social learning factor.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load states in the current location.</span>
<span class="sd">        If set `True` then the program will load state from &quot;states.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">psi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">c2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        --------</span>
<span class="sd">        inputs</span>
<span class="sd">        --------</span>
<span class="sd">        p_num:</span>
<span class="sd">           --description: the number of particles.</span>
<span class="sd">           --type: int</span>

<span class="sd">        psi0:</span>
<span class="sd">           --description: initial guesses of states (kets).</span>
<span class="sd">           --type: array</span>

<span class="sd">        max_episode:</span>
<span class="sd">            --description: max number of the training episodes.</span>
<span class="sd">            --type: int</span>

<span class="sd">        c0:</span>
<span class="sd">            --description: damping factor that assists convergence.</span>
<span class="sd">            --type: float</span>

<span class="sd">        c1:</span>
<span class="sd">            --description: exploitation weight that attract the particle to its best </span>
<span class="sd">            previous position.</span>
<span class="sd">            --type: float</span>

<span class="sd">        c2:</span>
<span class="sd">            --description: exploitation weight that attract the particle to the best </span>
<span class="sd">            position in the neighborhood.</span>
<span class="sd">            --type: float</span>

<span class="sd">        seed:</span>
<span class="sd">            --description: random seed.</span>
<span class="sd">            --type: int</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">is_int</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span> <span class="k">if</span> <span class="n">is_int</span> <span class="k">else</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="n">max_episode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span> <span class="o">=</span> <span class="n">c0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose HCRB as the objective function. </span>

<span class="sd">        **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">        QFI as the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Sopt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Sopt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.PSO_Sopt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Sopt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/PSO_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Sopt.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Sopt.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose HCRB as the objective function. </p>
<p><strong>Note:</strong> in single parameter estimation, HCRB is equivalent to QFI, please choose 
QFI as the objective function.</p>
<h4 id="quanestimation.PSO_Sopt.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Sopt.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/PSO_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose HCRB as the objective function. </span>

<span class="sd">    **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">    QFI as the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Sopt.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.PSO_Sopt.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.PSO_Sopt.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Sopt.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/PSO_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="state-optimization-de"><strong>State Optimization DE</strong><a class="headerlink" href="#state-optimization-de" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.DE_Sopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.StateOpt.StateStruct.StateSystem" href="#quanestimation.StateSystem">StateSystem</a></code></p>

  
      <h3 id="quanestimation.DE_Sopt--attributes">Attributes<a class="headerlink" href="#quanestimation.DE_Sopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong>  <code>bool</code>
    -- Whether or not to save all the states.<br />
    If set <code>True</code> then the states and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the state in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of populations.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>c:</strong> <code>float</code>
    -- Mutation constant.</p>
<p><strong>cr:</strong> <code>float</code>
    -- Crossover constant.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load states in the current location.<br />
    If set <code>True</code> then the program will load state from "states.csv"
    file in the current location and use it as the initial state.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/StateOpt/DE_Sopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DE_Sopt</span><span class="p">(</span><span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:**  `bool`</span>
<span class="sd">        -- Whether or not to save all the states.  </span>
<span class="sd">        If set `True` then the states and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the state in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of populations.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **c:** `float`</span>
<span class="sd">        -- Mutation constant.</span>

<span class="sd">    &gt; **cr:** `float`</span>
<span class="sd">        -- Crossover constant.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load states in the current location.  </span>
<span class="sd">        If set `True` then the program will load state from &quot;states.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">psi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">cr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">State</span><span class="o">.</span><span class="n">StateSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span> <span class="o">=</span> <span class="n">cr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is QFI and in </span>
<span class="sd">        multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose HCRB as the objective function. </span>

<span class="sd">        **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">        QFI as the objective function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Sopt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Sopt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.DE_Sopt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Sopt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/DE_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Sopt.HCRB" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Sopt.HCRB" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose HCRB as the objective function. </p>
<p><strong>Note:</strong> in single parameter estimation, HCRB is equivalent to QFI, please choose 
QFI as the objective function.</p>
<h4 id="quanestimation.DE_Sopt.HCRB--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Sopt.HCRB--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/DE_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">HCRB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose HCRB as the objective function. </span>

<span class="sd">    **Note:** in single parameter estimation, HCRB is equivalent to QFI, please choose </span>
<span class="sd">    QFI as the objective function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">HCRB</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Sopt.QFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.DE_Sopt.QFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose QFI or <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is QFI and in 
multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WF^{-1})\)</span>.</p>
<h4 id="quanestimation.DE_Sopt.QFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Sopt.QFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD).</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/StateOpt/DE_Sopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">QFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose QFI or $\mathrm{Tr}(WF^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is QFI and in </span>
<span class="sd">    multiparameter estimation it will be $\mathrm{Tr}(WF^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">QFIM</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><!-- 
### **State Optimization with DDPG**
::: quanestimation.DDPG_Sopt -->

<hr />
<h2 id="measurement-optimization"><strong>Measurement Optimization</strong><a class="headerlink" href="#measurement-optimization" title="Permanent link">&para;</a></h2>
<p>In QuanEstimation, three measurement optimization scenarios are considered. The first one
is to optimize a set of rank-one projective measurement, it can be written in a specific
basis <span class="arithmatex">\(\{|\phi_i\rangle\}\)</span> with <span class="arithmatex">\(|\phi_i\rangle=\sum_j C_{ij}|j\rangle\)</span> in the Hilbert space 
as <span class="arithmatex">\(\{|\phi_i\rangle\langle\phi_i|\}\)</span>. In this case, the goal is to search a set of optimal 
coefficients <span class="arithmatex">\(C_{ij}\)</span>. The second scenario is to find the optimal linear combination of 
an input measurement <span class="arithmatex">\(\{\Pi_j\}\)</span>. The third scenario is to find the optimal rotated 
measurement of an input measurement. After rotation, the new measurement is
<span class="arithmatex">\(\{U\Pi_i U^{\dagger}\}\)</span>, where <span class="arithmatex">\(U=\prod_k \exp(i s_k\lambda_k)\)</span> with <span class="arithmatex">\(\lambda_k\)</span> a SU(<span class="arithmatex">\(N\)</span>) 
generator and <span class="arithmatex">\(s_k\)</span> a real number in the regime <span class="arithmatex">\([0,2\pi]\)</span>. In this scenario, the goal is 
to search a set of optimal coefficients <span class="arithmatex">\(s_k\)</span>. Here different algorithms are invoked to 
search the optimal measurement include particle swarm optimization (PSO) <a href="#Kennedy1995">[1]</a>, 
differential evolution (DE) <a href="#Storn1997">[2]</a>, and automatic differentiation (AD) [[3]]
(#Baydin2018).</p>
<h3 id="base_2"><strong>Base</strong><a class="headerlink" href="#base_2" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.MeasurementSystem"></a>
  <div class="doc doc-contents first">

  
      <p>Attributes</p>
<hr />
<blockquote>
<p><strong>mtype:</strong> <code>string</code>
     -- The type of scenarios for the measurement optimization. Options are:<br />
     "projection" (default) -- Optimization of rank-one projective measurements.<br />
     "input" -- Find the optimal linear combination or the optimal rotated measurement 
     of a given set of POVM.</p>
<p><strong>minput:</strong> <code>list</code>
     -- In the case of optimization of rank-one projective measurements, the 
     <code>minput</code> should keep empty. For finding the optimal linear combination and 
     the optimal rotated measurement of a given set of POVM, the input rule are 
     <code>minput=["LC", [Pi1,Pi2,...], m]</code> and <code>minput=["LC", [Pi1,Pi2,...]]</code> respectively.
     Here <code>[Pi1,Pi2,...]</code> represents a list of input POVM and <code>m</code> is the number of operators 
     of the output measurement. </p>
<p><strong>savefile:</strong> <code>bool</code>
     -- Whether or not to save all the measurements.<br />
     If set <code>True</code> then the measurements and the values of the 
     objective function obtained in all episodes will be saved during 
     the training. If set <code>False</code> the measurement in the final 
     episode and the values of the objective function in all episodes 
     will be saved.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
     -- Initial guesses of measurements.</p>
<p><strong>seed:</strong> <code>int</code>
     -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
     -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
     -- Whether or not to load measurements in the current location.<br />
     If set <code>True</code> then the program will load measurement from "measurements.csv"
     file in the current location and use it as the initial measurement.</p>
<p><strong>dyn_method:</strong> <code>string</code>
     -- The method for solving the Lindblad dynamcs. Options are:
     "expm" (default) -- matrix exponential.
     "ode" -- ordinary differential equation solvers.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/MeasurementOpt/MeasurementStruct.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MeasurementSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **mtype:** `string`</span>
<span class="sd">        -- The type of scenarios for the measurement optimization. Options are:  </span>
<span class="sd">        &quot;projection&quot; (default) -- Optimization of rank-one projective measurements.  </span>
<span class="sd">        &quot;input&quot; -- Find the optimal linear combination or the optimal rotated measurement </span>
<span class="sd">        of a given set of POVM.</span>

<span class="sd">    &gt; **minput:** `list`</span>
<span class="sd">        -- In the case of optimization of rank-one projective measurements, the </span>
<span class="sd">        `minput` should keep empty. For finding the optimal linear combination and </span>
<span class="sd">        the optimal rotated measurement of a given set of POVM, the input rule are </span>
<span class="sd">        `minput=[&quot;LC&quot;, [Pi1,Pi2,...], m]` and `minput=[&quot;LC&quot;, [Pi1,Pi2,...]]` respectively.</span>
<span class="sd">        Here `[Pi1,Pi2,...]` represents a list of input POVM and `m` is the number of operators </span>
<span class="sd">        of the output measurement. </span>

<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the measurements.  </span>
<span class="sd">        If set `True` then the measurements and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the measurement in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">   &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load measurements in the current location.  </span>
<span class="sd">        If set `True` then the program will load measurement from &quot;measurements.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial measurement.</span>

<span class="sd">    &gt; **dyn_method:** `string`</span>
<span class="sd">        -- The method for solving the Lindblad dynamcs. Options are:</span>
<span class="sd">        &quot;expm&quot; (default) -- matrix exponential.</span>
<span class="sd">        &quot;ode&quot; -- ordinary differential equation solvers.  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">minput</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">=</span> <span class="n">mtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minput</span> <span class="o">=</span> <span class="n">minput</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span> <span class="o">=</span> <span class="n">savefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">measurement0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnum</span><span class="p">,</span> <span class="n">max_episode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;measurements.dat&quot;</span><span class="p">):</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;measurements.dat&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">:</span>
                <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mnum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_episode</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mnum</span><span class="p">)])</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;measurements&quot;</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The dynamics of a density matrix is of the form  </span>

<span class="sd">        \begin{align}</span>
<span class="sd">        \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">        &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">        \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">        \end{align} </span>

<span class="sd">        where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">        system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">        operator and corresponding decay rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **tspan:** `array`</span>
<span class="sd">            -- Time length for the evolution.</span>

<span class="sd">        &gt; **rho0:** `matrix`</span>
<span class="sd">            -- Initial state (density matrix).</span>

<span class="sd">        &gt; **H0:** `matrix or list`</span>
<span class="sd">            -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">            independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">        &gt; **dH:** `list`</span>
<span class="sd">            -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">            estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">            parameter.</span>

<span class="sd">        &gt; **Hc:** `list`</span>
<span class="sd">            -- Control Hamiltonians.</span>

<span class="sd">        &gt; **ctrl:** `list of arrays`</span>
<span class="sd">            -- Control coefficients.</span>

<span class="sd">        &gt; **decay:** `list`</span>
<span class="sd">            -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">            decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">            $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">            corresponding decay rate.</span>

<span class="sd">        &gt; **dyn_method:** `string`</span>
<span class="sd">            -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">            &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">            &quot;ode&quot; -- Solving the differential equations directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

        <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
        <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;projection&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
            <span class="n">QJLType_C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)):</span>
                    <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
                    <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                    <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Projection</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LC&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1">## optimize the combination of a set of SIC-POVM</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                        <span class="s2">&quot;sic_fiducial_vectors/d</span><span class="si">%d</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span>
                    <span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">fiducial</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span>
                    <span class="n">fiducial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fiducial</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">sic_povm</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">## optimize the combination of a set of given POVMs</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                            <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                    <span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span>
                                <span class="p">)</span>
                        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                            <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                            <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">)]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">m0</span><span class="p">]</span> <span class="k">for</span> <span class="n">m0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">]</span>


                <span class="n">QJLType_B</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Float64</span><span class="p">]]</span>
                <span class="n">QJLType_pb</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Matrix</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
                <span class="n">QJLType_m0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_B</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_pb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_m0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_LinearComb</span><span class="p">(</span>
                    <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">M_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">## optimize the coefficients of the rotation matrix</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The initial POVM should not be empty!&quot;</span><span class="p">)</span>
                    <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span><span class="p">)</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">=</span> <span class="s2">&quot;rotation&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                    <span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
                <span class="n">QJLType_pb</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Matrix</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_pb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Rotation</span><span class="p">(</span>
                    <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">Lambda</span><span class="o">=</span><span class="p">[],</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for the first input of minput, supported values are &#39;LC&#39; and &#39;rotation&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for mtype, supported values are &#39;projection&#39; and &#39;input&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">ctrl</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
            <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: too many coefficients sequences&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are set to be 0.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                    <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Htot</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H0</span><span class="p">)):</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="c1">#### linear interpolation  ####</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                        <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                    <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
                <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The parameterization of a state is</span>
<span class="sd">        \begin{align}</span>
<span class="sd">        \rho=\sum_i K_i\rho_0K_i^{\dagger},</span>
<span class="sd">        \end{align} </span>

<span class="sd">        where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **rho0:** `matrix`</span>
<span class="sd">            -- Initial state (density matrix).</span>

<span class="sd">        &gt; **K:** `list`</span>
<span class="sd">            -- Kraus operators.</span>

<span class="sd">        &gt; **dK:** `list`</span>
<span class="sd">            -- Derivatives of the Kraus operators on the unknown parameters to be </span>
<span class="sd">            estimated. For example, dK[0] is the derivative vector on the first </span>
<span class="sd">            parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
        <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">=</span> <span class="n">para_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">para_num</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_num</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">K</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;projection&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)):</span>
                    <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
                    <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                    <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Projection</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LC&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1">## optimize the combination of a set of SIC-POVM</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                        <span class="s2">&quot;sic_fiducial_vectors/d</span><span class="si">%d</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span>
                    <span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">fiducial</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span>
                    <span class="n">fiducial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fiducial</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">sic_povm</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">## optimize the combination of a set of given POVMs</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                            <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                    <span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span>
                                <span class="p">)</span>
                        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                            <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                            <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">))</span>
                    <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_LinearComb</span><span class="p">(</span>
                    <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">M_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">## optimize the coefficients of the rotation matrix</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The initial POVM should not be empty!&quot;</span><span class="p">)</span>
                    <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span><span class="p">)</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">=</span> <span class="s2">&quot;rotation&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                    <span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Rotation</span><span class="p">(</span>
                    <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">Lambda</span><span class="o">=</span><span class="p">[],</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for the first input of minput, supported values are &#39;LC&#39; and &#39;rotation&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for mtype, supported values are &#39;projection&#39; and &#39;input&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Supported type of dynamics are Lindblad and Kraus.&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span>
            <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span>
        <span class="p">)</span>  <span class="c1">#### m=[]</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.MeasurementSystem.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.MeasurementSystem.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.MeasurementSystem.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.MeasurementSystem.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/MeasurementOpt/MeasurementStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Supported type of dynamics are Lindblad and Kraus.&quot;</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span>
        <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span>
    <span class="p">)</span>  <span class="c1">#### m=[]</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.MeasurementSystem.Kraus" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">Kraus</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">)</span></code>

<a href="#quanestimation.MeasurementSystem.Kraus" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>The parameterization of a state is
\begin{align}
\rho=\sum_i K_i\rho_0K_i^{\dagger},
\end{align} </p>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, <span class="arithmatex">\(K_i\)</span> is the Kraus operator.</p>
<h4 id="quanestimation.MeasurementSystem.Kraus--parameters">Parameters<a class="headerlink" href="#quanestimation.MeasurementSystem.Kraus--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
<p><strong>K:</strong> <code>list</code>
    -- Kraus operators.</p>
<p><strong>dK:</strong> <code>list</code>
    -- Derivatives of the Kraus operators on the unknown parameters to be 
    estimated. For example, dK[0] is the derivative vector on the first 
    parameter.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/MeasurementOpt/MeasurementStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The parameterization of a state is</span>
<span class="sd">    \begin{align}</span>
<span class="sd">    \rho=\sum_i K_i\rho_0K_i^{\dagger},</span>
<span class="sd">    \end{align} </span>

<span class="sd">    where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &gt; **K:** `list`</span>
<span class="sd">        -- Kraus operators.</span>

<span class="sd">    &gt; **dK:** `list`</span>
<span class="sd">        -- Derivatives of the Kraus operators on the unknown parameters to be </span>
<span class="sd">        estimated. For example, dK[0] is the derivative vector on the first </span>
<span class="sd">        parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
    <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">=</span> <span class="n">para_num</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">para_num</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_num</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">K</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;projection&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)):</span>
                <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Projection</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LC&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1">## optimize the combination of a set of SIC-POVM</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                    <span class="s2">&quot;sic_fiducial_vectors/d</span><span class="si">%d</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span>
                <span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">fiducial</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span>
                <span class="n">fiducial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fiducial</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">sic_povm</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">## optimize the combination of a set of given POVMs</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span>
                            <span class="p">)</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_LinearComb</span><span class="p">(</span>
                <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">M_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">## optimize the coefficients of the rotation matrix</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The initial POVM should not be empty!&quot;</span><span class="p">)</span>
                <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">=</span> <span class="s2">&quot;rotation&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Rotation</span><span class="p">(</span>
                <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">Lambda</span><span class="o">=</span><span class="p">[],</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for the first input of minput, supported values are &#39;LC&#39; and &#39;rotation&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for mtype, supported values are &#39;projection&#39; and &#39;input&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.MeasurementSystem.dynamics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dynamics</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s1">&#39;expm&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.MeasurementSystem.dynamics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>The dynamics of a density matrix is of the form  </p>
<div class="arithmatex">\[\begin{align}
\partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\
&amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}
\left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),
\end{align}\]</div>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, H is the Hamiltonian of the 
system, <span class="arithmatex">\(\Gamma_i\)</span> and <span class="arithmatex">\(\gamma_i\)</span> are the <span class="arithmatex">\(i\mathrm{th}\)</span> decay 
operator and corresponding decay rate.</p>
<h4 id="quanestimation.MeasurementSystem.dynamics--parameters">Parameters<a class="headerlink" href="#quanestimation.MeasurementSystem.dynamics--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>tspan:</strong> <code>array</code>
    -- Time length for the evolution.</p>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
<p><strong>H0:</strong> <code>matrix or list</code>
    -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-
    independent and a list of length equal to <code>tspan</code> when it is time-dependent.</p>
<p><strong>dH:</strong> <code>list</code>
    -- Derivatives of the free Hamiltonian on the unknown parameters to be 
    estimated. For example, dH[0] is the derivative vector on the first 
    parameter.</p>
<p><strong>Hc:</strong> <code>list</code>
    -- Control Hamiltonians.</p>
<p><strong>ctrl:</strong> <code>list of arrays</code>
    -- Control coefficients.</p>
<p><strong>decay:</strong> <code>list</code>
    -- Decay operators and the corresponding decay rates. Its input rule is 
    decay=[[<span class="arithmatex">\(\Gamma_1\)</span>, <span class="arithmatex">\(\gamma_1\)</span>], [<span class="arithmatex">\(\Gamma_2\)</span>,<span class="arithmatex">\(\gamma_2\)</span>],...], where <span class="arithmatex">\(\Gamma_1\)</span> 
    <span class="arithmatex">\((\Gamma_2)\)</span> represents the decay operator and <span class="arithmatex">\(\gamma_1\)</span> <span class="arithmatex">\((\gamma_2)\)</span> is the 
    corresponding decay rate.</p>
<p><strong>dyn_method:</strong> <code>string</code>
    -- Setting the method for solving the Lindblad dynamics. Options are:<br />
    "expm" (default) -- Matrix exponential.<br />
    "ode" -- Solving the differential equations directly.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/MeasurementOpt/MeasurementStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The dynamics of a density matrix is of the form  </span>

<span class="sd">    \begin{align}</span>
<span class="sd">    \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">    &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">    \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">    \end{align} </span>

<span class="sd">    where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">    system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">    operator and corresponding decay rate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **tspan:** `array`</span>
<span class="sd">        -- Time length for the evolution.</span>

<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &gt; **H0:** `matrix or list`</span>
<span class="sd">        -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">        independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">    &gt; **dH:** `list`</span>
<span class="sd">        -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">        estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">        parameter.</span>

<span class="sd">    &gt; **Hc:** `list`</span>
<span class="sd">        -- Control Hamiltonians.</span>

<span class="sd">    &gt; **ctrl:** `list of arrays`</span>
<span class="sd">        -- Control coefficients.</span>

<span class="sd">    &gt; **decay:** `list`</span>
<span class="sd">        -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">        decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">        $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">        corresponding decay rate.</span>

<span class="sd">    &gt; **dyn_method:** `string`</span>
<span class="sd">        -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">        &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">        &quot;ode&quot; -- Solving the differential equations directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

    <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
    <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;projection&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
        <span class="n">QJLType_C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)):</span>
                <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Projection</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LC&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1">## optimize the combination of a set of SIC-POVM</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                    <span class="s2">&quot;sic_fiducial_vectors/d</span><span class="si">%d</span><span class="s2">.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span>
                <span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">fiducial</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span>
                <span class="n">fiducial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fiducial</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">sic_povm</span><span class="p">(</span><span class="n">fiducial</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">## optimize the combination of a set of given POVMs</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span>
                            <span class="p">)</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">m0</span><span class="p">]</span> <span class="k">for</span> <span class="n">m0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">]</span>


            <span class="n">QJLType_B</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Float64</span><span class="p">]]</span>
            <span class="n">QJLType_pb</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Matrix</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
            <span class="n">QJLType_m0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_B</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_pb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_m0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_LinearComb</span><span class="p">(</span>
                <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">M_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">M_num</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;rotation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">## optimize the coefficients of the rotation matrix</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be a list!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The initial POVM should not be empty!&quot;</span><span class="p">)</span>
                <span class="n">accu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The given POVMs should be semidefinite!&quot;</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">M</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">accu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The sum of the given POVMs should be identity matrix!&quot;</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">=</span> <span class="s2">&quot;rotation&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
                <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
            <span class="n">QJLType_pb</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Matrix</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_pb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Mopt_Rotation</span><span class="p">(</span>
                <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">POVM_basis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">povm_basis</span><span class="p">,</span> <span class="n">Lambda</span><span class="o">=</span><span class="p">[],</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for the first input of minput, supported values are &#39;LC&#39; and &#39;rotation&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">minput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for mtype, supported values are &#39;projection&#39; and &#39;input&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">ctrl</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
        <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: too many coefficients sequences&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are set to be 0.&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                <span class="n">ctrl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Htot</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H0</span><span class="p">)):</span>
                    <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)])</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="c1">#### linear interpolation  ####</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                    <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">]</span>
                <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>
                <span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">))])</span>
                    <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                <span class="p">]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">)))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="measurement-optimization-with-ad"><strong>Measurement optimization with AD</strong><a class="headerlink" href="#measurement-optimization-with-ad" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.AD_Mopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.MeasurementOpt.MeasurementStruct.MeasurementSystem" href="#quanestimation.MeasurementSystem">MeasurementSystem</a></code></p>

  
      <h3 id="quanestimation.AD_Mopt--attributes">Attributes<a class="headerlink" href="#quanestimation.AD_Mopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the measurements.<br />
    If set <code>True</code> then the measurements and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the measurement in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>Adam:</strong> <code>bool</code>
    -- Whether or not to use Adam for updating measurements.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
    -- Initial guesses of measurements.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>epsilon:</strong> <code>float</code>
    -- Learning rate.</p>
<p><strong>beta1:</strong> <code>float</code>
    -- The exponential decay rate for the first moment estimates.</p>
<p><strong>beta2:</strong> <code>float</code>
    -- The exponential decay rate for the second moment estimates.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load measurements in the current location.<br />
    If set <code>True</code> then the program will load measurement from "measurements.csv"
    file in the current location and use it as the initial measurement.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/MeasurementOpt/AD_Mopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AD_Mopt</span><span class="p">(</span><span class="n">Measurement</span><span class="o">.</span><span class="n">MeasurementSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the measurements.  </span>
<span class="sd">        If set `True` then the measurements and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the measurement in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **Adam:** `bool`</span>
<span class="sd">        -- Whether or not to use Adam for updating measurements.</span>

<span class="sd">    &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **epsilon:** `float`</span>
<span class="sd">        -- Learning rate.</span>

<span class="sd">    &gt; **beta1:** `float`</span>
<span class="sd">        -- The exponential decay rate for the first moment estimates.</span>

<span class="sd">    &gt; **beta2:** `float`</span>
<span class="sd">        -- The exponential decay rate for the second moment estimates.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load measurements in the current location.  </span>
<span class="sd">        If set `True` then the program will load measurement from &quot;measurements.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial measurement.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mtype</span><span class="p">,</span>
        <span class="n">minput</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">Adam</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">measurement0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">beta1</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
        <span class="n">beta2</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Measurement</span><span class="o">.</span><span class="n">MeasurementSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">minput</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span> 
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span> <span class="o">=</span> <span class="n">Adam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">=</span> <span class="n">beta1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">=</span> <span class="n">beta2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;projection&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;AD is not available when mtype is projection. Supported methods are &#39;PSO&#39; and &#39;DE&#39;.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.AD_Mopt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.AD_Mopt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.AD_Mopt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.AD_Mopt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/MeasurementOpt/AD_Mopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">==</span> <span class="s2">&quot;projection&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;AD is not available when mtype is projection. Supported methods are &#39;PSO&#39; and &#39;DE&#39;.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h2 id="measurement-optimization-with-pso"><strong>Measurement Optimization with PSO</strong><a class="headerlink" href="#measurement-optimization-with-pso" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<a id="quanestimation.PSO_Mopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.MeasurementOpt.MeasurementStruct.MeasurementSystem" href="#quanestimation.MeasurementSystem">MeasurementSystem</a></code></p>

  
      <h3 id="quanestimation.PSO_Mopt--attributes">Attributes<a class="headerlink" href="#quanestimation.PSO_Mopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the measurements.<br />
    If set <code>True</code> then the measurements and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the measurement in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of particles.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
    -- Initial guesses of measurements.</p>
<p><strong>max_episode:</strong> <code>int or list</code>
    -- If it is an integer, for example max_episode=1000, it means the 
    program will continuously run 1000 episodes. However, if it is an
    array, for example max_episode=[1000,100], the program will run 
    1000 episodes in total but replace measurements of all  the particles 
    with global best every 100 episodes.</p>
<p><strong>c0:</strong> <code>float</code>
    -- The damping factor that assists convergence, also known as inertia weight.</p>
<p><strong>c1:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to its best previous 
    position, also known as cognitive learning factor.</p>
<p><strong>c2:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to the best position<br />
    in the neighborhood, also known as social learning factor.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load measurements in the current location.<br />
    If set <code>True</code> then the program will load measurement from "measurements.csv"
    file in the current location and use it as the initial measurement.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/MeasurementOpt/PSO_Mopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PSO_Mopt</span><span class="p">(</span><span class="n">Measurement</span><span class="o">.</span><span class="n">MeasurementSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the measurements.  </span>
<span class="sd">        If set `True` then the measurements and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the measurement in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of particles.</span>

<span class="sd">    &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **max_episode:** `int or list`</span>
<span class="sd">        -- If it is an integer, for example max_episode=1000, it means the </span>
<span class="sd">        program will continuously run 1000 episodes. However, if it is an</span>
<span class="sd">        array, for example max_episode=[1000,100], the program will run </span>
<span class="sd">        1000 episodes in total but replace measurements of all  the particles </span>
<span class="sd">        with global best every 100 episodes.</span>

<span class="sd">    &gt; **c0:** `float`</span>
<span class="sd">        -- The damping factor that assists convergence, also known as inertia weight.</span>

<span class="sd">    &gt; **c1:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to its best previous </span>
<span class="sd">        position, also known as cognitive learning factor.</span>

<span class="sd">    &gt; **c2:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to the best position  </span>
<span class="sd">        in the neighborhood, also known as social learning factor.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load measurements in the current location.  </span>
<span class="sd">        If set `True` then the program will load measurement from &quot;measurements.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial measurement.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mtype</span><span class="p">,</span>
        <span class="n">minput</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">measurement0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">c2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Measurement</span><span class="o">.</span><span class="n">MeasurementSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">minput</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="n">is_int</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_episode</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span> <span class="k">if</span> <span class="n">is_int</span> <span class="k">else</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="n">max_episode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span> <span class="o">=</span> <span class="n">c0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Mopt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Mopt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.PSO_Mopt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Mopt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/MeasurementOpt/PSO_Mopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="measurement-optimization-with-de"><strong>Measurement Optimization with DE</strong><a class="headerlink" href="#measurement-optimization-with-de" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.DE_Mopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.MeasurementOpt.MeasurementStruct.MeasurementSystem" href="#quanestimation.MeasurementSystem">MeasurementSystem</a></code></p>

  
      <h3 id="quanestimation.DE_Mopt--attributes">Attributes<a class="headerlink" href="#quanestimation.DE_Mopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the measurements.<br />
    If set <code>True</code> then the measurements and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the measurement in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of populations.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
    -- Initial guesses of measurements.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>c:</strong> <code>float</code>
    -- Mutation constant.</p>
<p><strong>cr:</strong> <code>float</code>
    -- Crossover constant.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
<p><strong>load:</strong> <code>bool</code>
    -- Whether or not to load measurements in the current location.<br />
    If set <code>True</code> then the program will load measurement from "measurements.csv"
    file in the current location and use it as the initial measurement.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/MeasurementOpt/DE_Mopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DE_Mopt</span><span class="p">(</span><span class="n">Measurement</span><span class="o">.</span><span class="n">MeasurementSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the measurements.  </span>
<span class="sd">        If set `True` then the measurements and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the measurement in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of populations.</span>

<span class="sd">    &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **c:** `float`</span>
<span class="sd">        -- Mutation constant.</span>

<span class="sd">    &gt; **cr:** `float`</span>
<span class="sd">        -- Crossover constant.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    &gt; **load:** `bool`</span>
<span class="sd">        -- Whether or not to load measurements in the current location.  </span>
<span class="sd">        If set `True` then the program will load measurement from &quot;measurements.csv&quot;</span>
<span class="sd">        file in the current location and use it as the initial measurement.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mtype</span><span class="p">,</span>
        <span class="n">minput</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">measurement0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">cr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Measurement</span><span class="o">.</span><span class="n">MeasurementSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">minput</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">load</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span> <span class="o">=</span> <span class="n">cr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Mopt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Mopt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.DE_Mopt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Mopt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/MeasurementOpt/DE_Mopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">,)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><hr />
<h2 id="comprehensive-optimization"><strong>Comprehensive Optimization</strong><a class="headerlink" href="#comprehensive-optimization" title="Permanent link">&para;</a></h2>
<p>In order to obtain the optimal parameter estimation schemes, it is necessary to
simultaneously optimize the probe state, control and measurement. The
comprehensive optimization for the probe state and measurement (SM), the probe
state and control (SC), the control and measurement (CM) and the probe state, 
control and measurement (SCM) are proposed for this. In QuanEstimation, the 
comprehensive optimization algorithms are particle swarm optimization (PSO), 
differential evolution (DE), and automatic differentiation (AD).</p>
<h3 id="base_3"><strong>Base</strong><a class="headerlink" href="#base_3" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.ComprehensiveSystem"></a>
  <div class="doc doc-contents first">

  
      <h3 id="quanestimation.ComprehensiveSystem--attributes">Attributes<a class="headerlink" href="#quanestimation.ComprehensiveSystem--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the optimized variables (probe states, 
    control coefficients and measurements).<br />
    If set <code>True</code> then the optimized variables and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the optimized variables in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>ctrl0:</strong> <code>list of arrays</code>
    -- Initial guesses of control coefficients.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
    -- Initial guesses of measurements.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ComprehensiveOpt/ComprehensiveStruct.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ComprehensiveSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the optimized variables (probe states, </span>
<span class="sd">        control coefficients and measurements).  </span>
<span class="sd">        If set `True` then the optimized variables and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the optimized variables in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **ctrl0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span> <span class="o">=</span> <span class="n">savefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="n">ctrl0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">psi0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">measurement0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_save_ctrls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cnum</span><span class="p">,</span> <span class="n">max_episode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;controls.dat&quot;</span><span class="p">):</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;controls.dat&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="s2">&quot;controls&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">:</span>
                <span class="n">controls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_episode</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">controls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnum</span><span class="p">)])</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;controls&quot;</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_save_ctrls_alt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cnum</span><span class="p">,</span> <span class="n">max_episode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;controls.dat&quot;</span><span class="p">):</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;controls.dat&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="s2">&quot;controls&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">:</span>
                <span class="n">controls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_episode</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">controls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dset</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnum</span><span class="p">)])</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;controls&quot;</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_save_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_episode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;states.dat&quot;</span><span class="p">):</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;states.dat&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">:</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_episode</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_save_meas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnum</span><span class="p">,</span> <span class="n">max_episode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;measurements.dat&quot;</span><span class="p">):</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s2">&quot;measurements.dat&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">:</span>
                <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mnum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_episode</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">dset</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mnum</span><span class="p">)])</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;measurements&quot;</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The dynamics of a density matrix is of the form </span>

<span class="sd">        \begin{align}</span>
<span class="sd">        \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">        &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">        \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">        \end{align} </span>

<span class="sd">        where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">        system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">        operator and corresponding decay rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **tspan:** `array`</span>
<span class="sd">            -- Time length for the evolution.</span>

<span class="sd">        &gt; **H0:** `matrix or list`</span>
<span class="sd">            -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">            independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">        &gt; **dH:** `list`</span>
<span class="sd">            -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">            estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">            parameter.</span>

<span class="sd">        &gt; **Hc:** `list`</span>
<span class="sd">            -- Control Hamiltonians.</span>

<span class="sd">        &gt; **ctrl:** `list of arrays`</span>
<span class="sd">            -- Control coefficients.</span>

<span class="sd">        &gt; **decay:** `list`</span>
<span class="sd">            -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">            decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">            $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">            corresponding decay rate.</span>

<span class="sd">        &gt; **ctrl_bound:** `array`</span>
<span class="sd">            -- Lower and upper bounds of the control coefficients.</span>
<span class="sd">            `ctrl_bound[0]` represents the lower bound of the control coefficients and</span>
<span class="sd">            `ctrl_bound[1]` represents the upper bound of the control coefficients.</span>

<span class="sd">        &gt; **dyn_method:** `string`</span>
<span class="sd">            -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">            &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">            &quot;ode&quot; -- Solving the differential equations directly. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">ctrl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span> <span class="o">=</span> <span class="n">Hc</span>

        <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
        <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">QJLType_psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">])</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

        <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl0</span><span class="p">)]</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
            <span class="p">]</span>

        <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">)</span>
        <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: </span><span class="se">\</span>
<span class="s2">                                too many coefficients sequences&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians </span><span class="se">\</span>
<span class="s2">                            but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are</span><span class="se">\</span>
<span class="s2">                            set to be 0.&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

        <span class="c1"># ## TODO</span>
        <span class="n">QJLType_ctrl</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Float64</span><span class="p">]]]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_ctrl</span><span class="p">,</span> <span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ctrls</span> <span class="p">]</span><span class="k">for</span> <span class="n">ctrls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">])</span>

        <span class="n">QJLType_C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
                <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
                <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="c1">#### linear interpolation  ####</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The parameterization of a state is</span>
<span class="sd">        \begin{align}</span>
<span class="sd">        \rho=\sum_i K_i\rho_0K_i^{\dagger},</span>
<span class="sd">        \end{align} </span>

<span class="sd">        where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **K:** `list`</span>
<span class="sd">            -- Kraus operators.</span>

<span class="sd">        &gt; **dK:** `list`</span>
<span class="sd">            -- Derivatives of the Kraus operators on the unknown parameters to be </span>
<span class="sd">            estimated. For example, dK[0] is the derivative vector on the first </span>
<span class="sd">            parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">k_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
        <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">=</span> <span class="n">para_num</span>
        <span class="n">dK_tp</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">para_num</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_num</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">K</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="n">dK_tp</span>

        <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">QJLType_psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">])</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
                <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
                <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">))])]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for comprehensive optimization. Options are:  </span>
<span class="sd">            &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">            &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">            &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">if</span> <span class="n">M</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">==</span> <span class="s2">&quot;single_para&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Program terminated. In the single-parameter scenario, the HCRB is equivalent to the QFI. Please choose &#39;QFIM&#39; as the objective function&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;QFIM&quot;</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">or</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;RLD&quot;</span> <span class="ow">or</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;LLD&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;CFIM&quot;</span><span class="p">:</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Please enter the correct values for target and LDtype. Supported target are &#39;QFIM&#39;, &#39;CFIM&#39; and &#39;HCRB&#39;, supported LDtype are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateControlOpt</span><span class="p">(</span>
            <span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_states</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_ctrls</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the control and measurement (CM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **rho0:** `matrix`</span>
<span class="sd">            -- Initial state (density matrix).</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">ControlMeasurementOpt</span><span class="p">(</span>
            <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_ctrls_alt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_meas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state and measurement (SM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">)</span>
                <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: </span><span class="se">\</span>
<span class="s2">                                 too many coefficients sequences.&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians </span><span class="se">\</span>
<span class="s2">                               but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are</span><span class="se">\</span>
<span class="s2">                               set to be 0.&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                        <span class="ne">DeprecationWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                        <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span>
                        <span class="p">]</span>
                        <span class="n">Htot</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Htot</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span>
                        <span class="p">]</span>
                        <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H0</span><span class="p">)):</span>
                            <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                        <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="c1">#### linear interpolation  ####</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                    <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                            <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                        <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span>
                        <span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                        <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                            <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">))]</span>
                            <span class="p">)</span>
                            <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                        <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span>
                        <span class="p">]</span>
                        <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span>
                        <span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                        <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                            <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">))]</span>
                            <span class="p">)</span>
                            <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                        <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                        <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
                <span class="n">freeHamiltonian</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
                <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Supported type of dynamics are Lindblad and Kraus.&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateMeasurementOpt</span><span class="p">(</span><span class="n">psi</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">),</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_states</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_meas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SCM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state, control and measurement (SCM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateControlMeasurementOpt</span><span class="p">(</span>
            <span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
        <span class="p">)</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

        <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_states</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_ctrls</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_save_meas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.ComprehensiveSystem.CM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CM</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.ComprehensiveSystem.CM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the control and measurement (CM).</p>
<h4 id="quanestimation.ComprehensiveSystem.CM--parameters">Parameters<a class="headerlink" href="#quanestimation.ComprehensiveSystem.CM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/ComprehensiveStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the control and measurement (CM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">ControlMeasurementOpt</span><span class="p">(</span>
        <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
        <span class="n">dyn_method</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_ctrls_alt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_meas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ComprehensiveSystem.Kraus" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">Kraus</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">)</span></code>

<a href="#quanestimation.ComprehensiveSystem.Kraus" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>The parameterization of a state is
\begin{align}
\rho=\sum_i K_i\rho_0K_i^{\dagger},
\end{align} </p>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, <span class="arithmatex">\(K_i\)</span> is the Kraus operator.</p>
<h4 id="quanestimation.ComprehensiveSystem.Kraus--parameters">Parameters<a class="headerlink" href="#quanestimation.ComprehensiveSystem.Kraus--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>K:</strong> <code>list</code>
    -- Kraus operators.</p>
<p><strong>dK:</strong> <code>list</code>
    -- Derivatives of the Kraus operators on the unknown parameters to be 
    estimated. For example, dK[0] is the derivative vector on the first 
    parameter.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/ComprehensiveStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The parameterization of a state is</span>
<span class="sd">    \begin{align}</span>
<span class="sd">    \rho=\sum_i K_i\rho_0K_i^{\dagger},</span>
<span class="sd">    \end{align} </span>

<span class="sd">    where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **K:** `list`</span>
<span class="sd">        -- Kraus operators.</span>

<span class="sd">    &gt; **dK:** `list`</span>
<span class="sd">        -- Derivatives of the Kraus operators on the unknown parameters to be </span>
<span class="sd">        estimated. For example, dK[0] is the derivative vector on the first </span>
<span class="sd">        parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">k_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
    <span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">=</span> <span class="n">para_num</span>
    <span class="n">dK_tp</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dK</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">para_num</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_num</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">K</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="n">dK_tp</span>

    <span class="k">if</span> <span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">QJLType_psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">])</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">))])]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ComprehensiveSystem.SC" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.ComprehensiveSystem.SC" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state and control (SC).</p>
<h4 id="quanestimation.ComprehensiveSystem.SC--parameters">Parameters<a class="headerlink" href="#quanestimation.ComprehensiveSystem.SC--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for comprehensive optimization. Options are:<br />
    "QFIM" (default) -- choose QFI (QFIM) as the objective function.<br />
    "CFIM" -- choose CFI (CFIM) as the objective function.<br />
    "HCRB" -- choose HCRB as the objective function.  </p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD). </p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/ComprehensiveStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for comprehensive optimization. Options are:  </span>
<span class="sd">        &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">        &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">        &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">if</span> <span class="n">M</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">M</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">==</span> <span class="s2">&quot;single_para&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Program terminated. In the single-parameter scenario, the HCRB is equivalent to the QFI. Please choose &#39;QFIM&#39; as the objective function&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">HCRB_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;QFIM&quot;</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;SLD&quot;</span> <span class="ow">or</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;RLD&quot;</span> <span class="ow">or</span> <span class="n">LDtype</span> <span class="o">==</span> <span class="s2">&quot;LLD&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QFIM_obj</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">,</span> <span class="n">LDtype</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;CFIM&quot;</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please enter the correct values for target and LDtype. Supported target are &#39;QFIM&#39;, &#39;CFIM&#39; and &#39;HCRB&#39;, supported LDtype are &#39;SLD&#39;, &#39;RLD&#39; and &#39;LLD&#39;.&quot;</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateControlOpt</span><span class="p">(</span>
        <span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
        <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_states</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_ctrls</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ComprehensiveSystem.SCM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SCM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.ComprehensiveSystem.SCM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state, control and measurement (SCM).</p>
<h4 id="quanestimation.ComprehensiveSystem.SCM--parameters">Parameters<a class="headerlink" href="#quanestimation.ComprehensiveSystem.SCM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/ComprehensiveStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SCM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state, control and measurement (SCM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">!=</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Supported type of dynamics is Lindblad.&quot;</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateControlMeasurementOpt</span><span class="p">(</span>
        <span class="n">psi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
        <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_states</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_ctrls</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">),</span> <span class="n">max_num</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_meas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ComprehensiveSystem.SM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.ComprehensiveSystem.SM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state and measurement (SM).</p>
<h4 id="quanestimation.ComprehensiveSystem.SM--parameters">Parameters<a class="headerlink" href="#quanestimation.ComprehensiveSystem.SM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/ComprehensiveStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state and measurement (SM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">)</span>
            <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: </span><span class="se">\</span>
<span class="s2">                             too many coefficients sequences.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians </span><span class="se">\</span>
<span class="s2">                           but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are</span><span class="se">\</span>
<span class="s2">                           set to be 0.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
                    <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span>
                    <span class="p">]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Htot</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span>
                    <span class="p">]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H0</span><span class="p">)):</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span>
                                <span class="p">[</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ctrl_num</span><span class="p">)</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="c1">#### linear interpolation  ####</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">))]</span>
                        <span class="p">)</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                    <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">H0</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span>
                    <span class="p">]</span>
                    <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hc</span><span class="p">))]</span>
                    <span class="n">Htot</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">S_ctrl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">Hc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">))]</span>
                        <span class="p">)</span>
                        <span class="n">Htot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_ctrl</span><span class="p">)</span>
                    <span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Htot</span>
                    <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Lindblad</span><span class="p">(</span>
            <span class="n">freeHamiltonian</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">dyn_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Supported type of dynamics are Lindblad and Kraus.&quot;</span>
            <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">CFIM_obj</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">opt</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">StateMeasurementOpt</span><span class="p">(</span><span class="n">psi</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">),</span> <span class="n">M</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">)</span>

    <span class="n">system</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstSystem</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span>
    <span class="p">)</span>
    <span class="n">QJL</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="n">max_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_states</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_save_meas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.ComprehensiveSystem.dynamics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dynamics</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s1">&#39;expm&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.ComprehensiveSystem.dynamics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>The dynamics of a density matrix is of the form </p>
<div class="arithmatex">\[\begin{align}
\partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\
&amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}
\left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),
\end{align}\]</div>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, H is the Hamiltonian of the 
system, <span class="arithmatex">\(\Gamma_i\)</span> and <span class="arithmatex">\(\gamma_i\)</span> are the <span class="arithmatex">\(i\mathrm{th}\)</span> decay 
operator and corresponding decay rate.</p>
<h4 id="quanestimation.ComprehensiveSystem.dynamics--parameters">Parameters<a class="headerlink" href="#quanestimation.ComprehensiveSystem.dynamics--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>tspan:</strong> <code>array</code>
    -- Time length for the evolution.</p>
<p><strong>H0:</strong> <code>matrix or list</code>
    -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-
    independent and a list of length equal to <code>tspan</code> when it is time-dependent.</p>
<p><strong>dH:</strong> <code>list</code>
    -- Derivatives of the free Hamiltonian on the unknown parameters to be 
    estimated. For example, dH[0] is the derivative vector on the first 
    parameter.</p>
<p><strong>Hc:</strong> <code>list</code>
    -- Control Hamiltonians.</p>
<p><strong>ctrl:</strong> <code>list of arrays</code>
    -- Control coefficients.</p>
<p><strong>decay:</strong> <code>list</code>
    -- Decay operators and the corresponding decay rates. Its input rule is 
    decay=[[<span class="arithmatex">\(\Gamma_1\)</span>, <span class="arithmatex">\(\gamma_1\)</span>], [<span class="arithmatex">\(\Gamma_2\)</span>,<span class="arithmatex">\(\gamma_2\)</span>],...], where <span class="arithmatex">\(\Gamma_1\)</span> 
    <span class="arithmatex">\((\Gamma_2)\)</span> represents the decay operator and <span class="arithmatex">\(\gamma_1\)</span> <span class="arithmatex">\((\gamma_2)\)</span> is the 
    corresponding decay rate.</p>
<p><strong>ctrl_bound:</strong> <code>array</code>
    -- Lower and upper bounds of the control coefficients.
    <code>ctrl_bound[0]</code> represents the lower bound of the control coefficients and
    <code>ctrl_bound[1]</code> represents the upper bound of the control coefficients.</p>
<p><strong>dyn_method:</strong> <code>string</code>
    -- Setting the method for solving the Lindblad dynamics. Options are:<br />
    "expm" (default) -- Matrix exponential.<br />
    "ode" -- Solving the differential equations directly.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/ComprehensiveStruct.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl_bound</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The dynamics of a density matrix is of the form </span>

<span class="sd">    \begin{align}</span>
<span class="sd">    \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">    &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">    \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">    \end{align} </span>

<span class="sd">    where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">    system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">    operator and corresponding decay rate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **tspan:** `array`</span>
<span class="sd">        -- Time length for the evolution.</span>

<span class="sd">    &gt; **H0:** `matrix or list`</span>
<span class="sd">        -- Free Hamiltonian. It is a matrix when the free Hamiltonian is time-</span>
<span class="sd">        independent and a list of length equal to `tspan` when it is time-dependent.</span>

<span class="sd">    &gt; **dH:** `list`</span>
<span class="sd">        -- Derivatives of the free Hamiltonian on the unknown parameters to be </span>
<span class="sd">        estimated. For example, dH[0] is the derivative vector on the first </span>
<span class="sd">        parameter.</span>

<span class="sd">    &gt; **Hc:** `list`</span>
<span class="sd">        -- Control Hamiltonians.</span>

<span class="sd">    &gt; **ctrl:** `list of arrays`</span>
<span class="sd">        -- Control coefficients.</span>

<span class="sd">    &gt; **decay:** `list`</span>
<span class="sd">        -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">        decay=[[$\Gamma_1$, $\gamma_1$], [$\Gamma_2$,$\gamma_2$],...], where $\Gamma_1$ </span>
<span class="sd">        $(\Gamma_2)$ represents the decay operator and $\gamma_1$ $(\gamma_2)$ is the </span>
<span class="sd">        corresponding decay rate.</span>

<span class="sd">    &gt; **ctrl_bound:** `array`</span>
<span class="sd">        -- Lower and upper bounds of the control coefficients.</span>
<span class="sd">        `ctrl_bound[0]` represents the lower bound of the control coefficients and</span>
<span class="sd">        `ctrl_bound[1]` represents the upper bound of the control coefficients.</span>

<span class="sd">    &gt; **dyn_method:** `string`</span>
<span class="sd">        -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">        &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">        &quot;ode&quot; -- Solving the differential equations directly. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">ctrl</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span> <span class="o">=</span> <span class="n">Hc</span>

    <span class="k">if</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Expm&quot;</span>
    <span class="k">elif</span> <span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="s2">&quot;Ode&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">QJLType_psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">])</span> <span class="c1"># Initial guesses of states (a list of arrays)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">Hc</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">Hc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Hc</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The derivative of Hamiltonian should be a list!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dH</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">dH</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Hamiltonian_derivative</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dH</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;single_para&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_type</span> <span class="o">=</span> <span class="s2">&quot;multi_para&quot;</span>

    <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decay</span><span class="p">))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decay_opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">decay_opt</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_bound</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="n">ctrl_bound</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">ctrl_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">ctrl0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ctrl0</span><span class="p">)]</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">))</span>
        <span class="p">]</span>

    <span class="n">ctrl_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">)</span>
    <span class="n">Hc_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_Hamiltonian</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Hc_num</span> <span class="o">&lt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> control Hamiltonians but </span><span class="si">%d</span><span class="s2"> coefficients sequences: </span><span class="se">\</span>
<span class="s2">                            too many coefficients sequences&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">Hc_num</span> <span class="o">&gt;</span> <span class="n">ctrl_num</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Not enough coefficients sequences: there are </span><span class="si">%d</span><span class="s2"> control Hamiltonians </span><span class="se">\</span>
<span class="s2">                        but </span><span class="si">%d</span><span class="s2"> coefficients sequences. The rest of the control sequences are</span><span class="se">\</span>
<span class="s2">                        set to be 0.&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">Hc_num</span><span class="p">,</span> <span class="n">ctrl_num</span><span class="p">),</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hc_num</span> <span class="o">-</span> <span class="n">ctrl_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="c1"># ## TODO</span>
    <span class="n">QJLType_ctrl</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Float64</span><span class="p">]]]</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_ctrl</span><span class="p">,</span> <span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ctrls</span> <span class="p">]</span><span class="k">for</span> <span class="n">ctrls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">])</span>

    <span class="n">QJLType_C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">ComplexF64</span><span class="p">]]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
            <span class="n">r_ini</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r_ini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_ini</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="n">gramschmidt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">QJLType_C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="c1">#### linear interpolation  ####</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tnum</span> <span class="o">=</span> <span class="n">number</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">H0_inter</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHamiltonian</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">H0_inter</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">pass</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="comprehensive-optimization-with-ad"><strong>Comprehensive optimization with AD</strong><a class="headerlink" href="#comprehensive-optimization-with-ad" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.AD_Compopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.ComprehensiveOpt.ComprehensiveStruct.ComprehensiveSystem" href="#quanestimation.ComprehensiveSystem">ComprehensiveSystem</a></code></p>

  
      <h3 id="quanestimation.AD_Compopt--attributes">Attributes<a class="headerlink" href="#quanestimation.AD_Compopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the optimized variables (probe states, 
    control coefficients and measurements).<br />
    If set <code>True</code> then the optimized variables and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the optimized variables in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>Adam:</strong> <code>bool</code>
    -- Whether or not to use Adam for updating.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>ctrl0:</strong> <code>list of arrays</code>
    -- Initial guesses of control coefficients.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
    -- Initial guesses of measurements.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>epsilon:</strong> <code>float</code>
    -- Learning rate.</p>
<p><strong>beta1:</strong> <code>float</code>
    -- The exponential decay rate for the first moment estimates.</p>
<p><strong>beta2:</strong> <code>float</code>
    -- The exponential decay rate for the second moment estimates.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ComprehensiveOpt/AD_Compopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AD_Compopt</span><span class="p">(</span><span class="n">Comp</span><span class="o">.</span><span class="n">ComprehensiveSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the optimized variables (probe states, </span>
<span class="sd">        control coefficients and measurements).  </span>
<span class="sd">        If set `True` then the optimized variables and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the optimized variables in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **Adam:** `bool`</span>
<span class="sd">        -- Whether or not to use Adam for updating.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **ctrl0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **epsilon:** `float`</span>
<span class="sd">        -- Learning rate.</span>

<span class="sd">    &gt; **beta1:** `float`</span>
<span class="sd">        -- The exponential decay rate for the first moment estimates.</span>

<span class="sd">    &gt; **beta2:** `float`</span>
<span class="sd">        -- The exponential decay rate for the second moment estimates.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">Adam</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">psi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">ctrl0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">measurement0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">beta1</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
        <span class="n">beta2</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Comp</span><span class="o">.</span><span class="n">ComprehensiveSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span> <span class="o">=</span> <span class="n">Adam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">=</span> <span class="n">beta1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">=</span> <span class="n">beta2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">            value of the objective function. Options are:  </span>
<span class="sd">            &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">            &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">            &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">        **Note:** AD is only available when target is &#39;QFIM&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">M</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;AD is not available when target is &#39;CFIM&#39;. Supported methods are &#39;PSO&#39; and &#39;DE&#39;.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;AD is not available when the target function is HCRB. Supported methods are &#39;PSO&#39; and &#39;DE&#39;.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstimation</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstimation</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.AD_Compopt.SC" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.AD_Compopt.SC" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state and control (SC).</p>
<h4 id="quanestimation.AD_Compopt.SC--parameters">Parameters<a class="headerlink" href="#quanestimation.AD_Compopt.SC--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for searching the minimum time to reach the given 
    value of the objective function. Options are:<br />
    "QFIM" (default) -- choose QFI (QFIM) as the objective function.<br />
    "CFIM" -- choose CFI (CFIM) as the objective function.<br />
    "HCRB" -- choose HCRB as the objective function.  </p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD). </p>
</blockquote>
<p><strong>Note:</strong> AD is only available when target is 'QFIM'.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/AD_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">        value of the objective function. Options are:  </span>
<span class="sd">        &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">        &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">        &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">    **Note:** AD is only available when target is &#39;QFIM&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;AD is not available when target is &#39;CFIM&#39;. Supported methods are &#39;PSO&#39; and &#39;DE&#39;.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s2">&quot;HCRB&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;AD is not available when the target function is HCRB. Supported methods are &#39;PSO&#39; and &#39;DE&#39;.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Adam</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstimation</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">QuanEstimation</span><span class="o">.</span><span class="n">AD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="comprehensive-optimization-with-pso"><strong>Comprehensive Optimization with PSO</strong><a class="headerlink" href="#comprehensive-optimization-with-pso" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.PSO_Compopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.ComprehensiveOpt.ComprehensiveStruct.ComprehensiveSystem" href="#quanestimation.ComprehensiveSystem">ComprehensiveSystem</a></code></p>

  
      <h3 id="quanestimation.PSO_Compopt--attributes">Attributes<a class="headerlink" href="#quanestimation.PSO_Compopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the optimized variables (probe states, 
    control coefficients and measurements).<br />
    If set <code>True</code> then the optimized variables and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the optimized variables in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of particles.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>ctrl0:</strong> <code>list of arrays</code>
    -- Initial guesses of control coefficients.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
    -- Initial guesses of measurements.</p>
<p><strong>max_episode:</strong> <code>int or list</code>
    -- If it is an integer, for example max_episode=1000, it means the 
    program will continuously run 1000 episodes. However, if it is an
    array, for example max_episode=[1000,100], the program will run 
    1000 episodes in total but replace states of all  the particles 
    with global best every 100 episodes.</p>
<p><strong>c0:</strong> <code>float</code>
    -- The damping factor that assists convergence, also known as inertia weight.</p>
<p><strong>c1:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to its best previous 
    position, also known as cognitive learning factor.</p>
<p><strong>c2:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to the best position<br />
    in the neighborhood, also known as social learning factor.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ComprehensiveOpt/PSO_Compopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PSO_Compopt</span><span class="p">(</span><span class="n">Comp</span><span class="o">.</span><span class="n">ComprehensiveSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the optimized variables (probe states, </span>
<span class="sd">        control coefficients and measurements).  </span>
<span class="sd">        If set `True` then the optimized variables and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the optimized variables in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of particles.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **ctrl0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **max_episode:** `int or list`</span>
<span class="sd">        -- If it is an integer, for example max_episode=1000, it means the </span>
<span class="sd">        program will continuously run 1000 episodes. However, if it is an</span>
<span class="sd">        array, for example max_episode=[1000,100], the program will run </span>
<span class="sd">        1000 episodes in total but replace states of all  the particles </span>
<span class="sd">        with global best every 100 episodes.</span>

<span class="sd">    &gt; **c0:** `float`</span>
<span class="sd">        -- The damping factor that assists convergence, also known as inertia weight.</span>

<span class="sd">    &gt; **c1:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to its best previous </span>
<span class="sd">        position, also known as cognitive learning factor.</span>

<span class="sd">    &gt; **c2:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to the best position  </span>
<span class="sd">        in the neighborhood, also known as social learning factor.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">psi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">ctrl0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">measurement0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">c2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Comp</span><span class="o">.</span><span class="n">ComprehensiveSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span> <span class="o">=</span> <span class="n">c0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">            value of the objective function. Options are:  </span>
<span class="sd">            &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">            &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">            &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span>
       <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the control and measurement (CM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **rho0:** `matrix`</span>
<span class="sd">            -- Initial state (density matrix).</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CM</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state and measurement (SM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SCM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state, the control and measurements (SCM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
            <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_particle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SCM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Compopt.CM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CM</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Compopt.CM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the control and measurement (CM).</p>
<h4 id="quanestimation.PSO_Compopt.CM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Compopt.CM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/PSO_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the control and measurement (CM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CM</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Compopt.SC" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.PSO_Compopt.SC" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state and control (SC).</p>
<h4 id="quanestimation.PSO_Compopt.SC--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Compopt.SC--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for searching the minimum time to reach the given 
    value of the objective function. Options are:<br />
    "QFIM" (default) -- choose QFI (QFIM) as the objective function.<br />
    "CFIM" -- choose CFI (CFIM) as the objective function.<br />
    "HCRB" -- choose HCRB as the objective function.  </p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD). </p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/PSO_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">        value of the objective function. Options are:  </span>
<span class="sd">        &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">        &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">        &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span>
   <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Compopt.SCM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SCM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Compopt.SCM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state, the control and measurements (SCM).</p>
<h4 id="quanestimation.PSO_Compopt.SCM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Compopt.SCM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/PSO_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SCM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state, the control and measurements (SCM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SCM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.PSO_Compopt.SM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.PSO_Compopt.SM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state and measurement (SM).</p>
<h4 id="quanestimation.PSO_Compopt.SM--parameters">Parameters<a class="headerlink" href="#quanestimation.PSO_Compopt.SM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/PSO_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state and measurement (SM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_particle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">PSO</span><span class="p">(</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">Vector</span><span class="p">[</span><span class="n">QJL</span><span class="o">.</span><span class="n">Int64</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_particle</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c0</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><h3 id="comprehensive-optimization-with-de"><strong>Comprehensive Optimization with DE</strong><a class="headerlink" href="#comprehensive-optimization-with-de" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.DE_Compopt"></a>
  <div class="doc doc-contents first">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="quanestimation.ComprehensiveOpt.ComprehensiveStruct.ComprehensiveSystem" href="#quanestimation.ComprehensiveSystem">ComprehensiveSystem</a></code></p>

  
      <h3 id="quanestimation.DE_Compopt--attributes">Attributes<a class="headerlink" href="#quanestimation.DE_Compopt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the optimized variables (probe states, 
    control coefficients and measurements).<br />
    If set <code>True</code> then the optimized variables and the values of the 
    objective function obtained in all episodes will be saved during 
    the training. If set <code>False</code> the optimized variables in the final 
    episode and the values of the objective function in all episodes 
    will be saved.</p>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of populations.</p>
<p><strong>psi0:</strong> <code>list of arrays</code>
    -- Initial guesses of states.</p>
<p><strong>ctrl0:</strong> <code>list of arrays</code>
    -- Initial guesses of control coefficients.</p>
<p><strong>measurement0:</strong> <code>list of arrays</code>
    -- Initial guesses of measurements.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>c:</strong> <code>float</code>
    -- Mutation constant.</p>
<p><strong>cr:</strong> <code>float</code>
    -- Crossover constant.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/ComprehensiveOpt/DE_Compopt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DE_Compopt</span><span class="p">(</span><span class="n">Comp</span><span class="o">.</span><span class="n">ComprehensiveSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the optimized variables (probe states, </span>
<span class="sd">        control coefficients and measurements).  </span>
<span class="sd">        If set `True` then the optimized variables and the values of the </span>
<span class="sd">        objective function obtained in all episodes will be saved during </span>
<span class="sd">        the training. If set `False` the optimized variables in the final </span>
<span class="sd">        episode and the values of the objective function in all episodes </span>
<span class="sd">        will be saved.</span>

<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of populations.</span>

<span class="sd">    &gt; **psi0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of states.</span>

<span class="sd">    &gt; **ctrl0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of control coefficients.</span>

<span class="sd">    &gt; **measurement0:** `list of arrays`</span>
<span class="sd">        -- Initial guesses of measurements.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **c:** `float`</span>
<span class="sd">        -- Mutation constant.</span>

<span class="sd">    &gt; **cr:** `float`</span>
<span class="sd">        -- Crossover constant.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">psi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">ctrl0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">measurement0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">cr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">Comp</span><span class="o">.</span><span class="n">ComprehensiveSystem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">ctrl0</span><span class="p">,</span> <span class="n">measurement0</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span> <span class="o">=</span> <span class="n">p_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span> <span class="o">=</span> <span class="n">cr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">            value of the objective function. Options are:  </span>
<span class="sd">            &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">            &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">            &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">        &gt; **LDtype:** `string`</span>
<span class="sd">            -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">            &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">            &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">            &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the control and measurement (CM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **rho0:** `matrix`</span>
<span class="sd">            -- Initial state (density matrix).</span>

<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CM</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state and measurement (SM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">SCM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprehensive optimization of the probe state, control and measurement (SCM).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
            <span class="n">ini_population</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SCM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Compopt.CM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CM</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Compopt.CM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the control and measurement (CM).</p>
<h4 id="quanestimation.DE_Compopt.CM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Compopt.CM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/DE_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the control and measurement (CM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">CM</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Compopt.SC" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;QFIM&#39;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s1">&#39;SLD&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.DE_Compopt.SC" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state and control (SC).</p>
<h4 id="quanestimation.DE_Compopt.SC--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Compopt.SC--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
<p><strong>target:</strong> <code>string</code>
    -- Objective functions for searching the minimum time to reach the given 
    value of the objective function. Options are:<br />
    "QFIM" (default) -- choose QFI (QFIM) as the objective function.<br />
    "CFIM" -- choose CFI (CFIM) as the objective function.<br />
    "HCRB" -- choose HCRB as the objective function.  </p>
<p><strong>LDtype:</strong> <code>string</code>
    -- Types of QFI (QFIM) can be set as the objective function. Options are:<br />
    "SLD" (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).<br />
    "RLD" -- QFI (QFIM) based on right logarithmic derivative (RLD).<br />
    "LLD" -- QFI (QFIM) based on left logarithmic derivative (LLD). </p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/DE_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[],</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;QFIM&quot;</span><span class="p">,</span> <span class="n">LDtype</span><span class="o">=</span><span class="s2">&quot;SLD&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state and control (SC).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Objective functions for searching the minimum time to reach the given </span>
<span class="sd">        value of the objective function. Options are:  </span>
<span class="sd">        &quot;QFIM&quot; (default) -- choose QFI (QFIM) as the objective function.  </span>
<span class="sd">        &quot;CFIM&quot; -- choose CFI (CFIM) as the objective function.  </span>
<span class="sd">        &quot;HCRB&quot; -- choose HCRB as the objective function.  </span>

<span class="sd">    &gt; **LDtype:** `string`</span>
<span class="sd">        -- Types of QFI (QFIM) can be set as the objective function. Options are:  </span>
<span class="sd">        &quot;SLD&quot; (default) -- QFI (QFIM) based on symmetric logarithmic derivative (SLD).  </span>
<span class="sd">        &quot;RLD&quot; -- QFI (QFIM) based on right logarithmic derivative (RLD).  </span>
<span class="sd">        &quot;LLD&quot; -- QFI (QFIM) based on left logarithmic derivative (LLD). </span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SC</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">LDtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Compopt.SCM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SCM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Compopt.SCM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state, control and measurement (SCM).</p>
<h4 id="quanestimation.DE_Compopt.SCM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Compopt.SCM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/DE_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SCM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state, control and measurement (SCM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrl0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SCM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.DE_Compopt.SM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">SM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.DE_Compopt.SM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Comprehensive optimization of the probe state and measurement (SM).</p>
<h4 id="quanestimation.DE_Compopt.SM--parameters">Parameters<a class="headerlink" href="#quanestimation.DE_Compopt.SM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/ComprehensiveOpt/DE_Compopt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive optimization of the probe state and measurement (SM).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ini_population</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alg</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">DE</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_num</span><span class="p">,</span>
        <span class="n">ini_population</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">SM</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div><hr />
<h2 id="adaptive-measurement-schemes"><strong>Adaptive measurement schemes</strong><a class="headerlink" href="#adaptive-measurement-schemes" title="Permanent link">&para;</a></h2>
<p>In QuanEstimation, the Hamiltonian of the adaptive system should be written as
<span class="arithmatex">\(H(\textbf{x}+\textbf{u})\)</span> with <span class="arithmatex">\(\textbf{x}\)</span> the unknown parameters and <span class="arithmatex">\(\textbf{u}\)</span> 
the tunable parameters. The tunable parameters <span class="arithmatex">\(\textbf{u}\)</span> are used to let the 
Hamiltonian work at the optimal point <span class="arithmatex">\(\textbf{x}_{\mathrm{opt}}\)</span>. </p>
<h3 id="adaptive-measurement"><strong>Adaptive measurement</strong><a class="headerlink" href="#adaptive-measurement" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<a id="quanestimation.Adapt"></a>
  <div class="doc doc-contents first">

  
      <h3 id="quanestimation.Adapt--attributes">Attributes<a class="headerlink" href="#quanestimation.Adapt--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>x:</strong> <code>list</code>
    -- The regimes of the parameters for the integral.</p>
<p><strong>p:</strong> <code>multidimensional array</code>
    -- The prior distribution.</p>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
<p><strong>method:</strong> <code>string</code>
    -- Choose the method for updating the tunable parameters (u). Options are:<br />
    "FOP" (default) -- Fix optimal point.<br />
    "MI" -- mutual information.</p>
<p><strong>savefile:</strong> <code>bool</code>
    -- Whether or not to save all the posterior distributions.<br />
    If set <code>True</code> then three files "pout.npy", "xout.npy" and "y.npy" will be 
    generated including the posterior distributions, the estimated values, and
    the experimental results in the iterations. If set <code>False</code> the posterior 
    distribution in the final iteration, the estimated values and the experimental 
    results in all iterations will be saved in "pout.npy", "xout.npy" and "y.npy". </p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Adapt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **x:** `list`</span>
<span class="sd">        -- The regimes of the parameters for the integral.</span>

<span class="sd">    &gt; **p:** `multidimensional array`</span>
<span class="sd">        -- The prior distribution.</span>

<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &gt; **method:** `string`</span>
<span class="sd">        -- Choose the method for updating the tunable parameters (u). Options are:  </span>
<span class="sd">        &quot;FOP&quot; (default) -- Fix optimal point.  </span>
<span class="sd">        &quot;MI&quot; -- mutual information.</span>

<span class="sd">    &gt; **savefile:** `bool`</span>
<span class="sd">        -- Whether or not to save all the posterior distributions.  </span>
<span class="sd">        If set `True` then three files &quot;pout.npy&quot;, &quot;xout.npy&quot; and &quot;y.npy&quot; will be </span>
<span class="sd">        generated including the posterior distributions, the estimated values, and</span>
<span class="sd">        the experimental results in the iterations. If set `False` the posterior </span>
<span class="sd">        distribution in the final iteration, the estimated values and the experimental </span>
<span class="sd">        results in all iterations will be saved in &quot;pout.npy&quot;, &quot;xout.npy&quot; and &quot;y.npy&quot;. </span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;FOP&quot;</span><span class="p">,</span> <span class="n">savefile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span> <span class="o">=</span> <span class="n">max_episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span> <span class="o">=</span> <span class="n">savefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamics of the density matrix of the form </span>

<span class="sd">        \begin{align}</span>
<span class="sd">        \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">        &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">        \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">        \end{align} </span>

<span class="sd">        where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">        system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">        operator and decay rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **tspan:** `array`</span>
<span class="sd">            -- Time length for the evolution.</span>

<span class="sd">        &gt; **H0:** `multidimensional list`</span>
<span class="sd">            -- Free Hamiltonian with respect to the values in x.</span>

<span class="sd">        &gt; **dH:** `multidimensional list`</span>
<span class="sd">            -- Derivatives of the free Hamiltonian with respect to the unknown parameters </span>
<span class="sd">            to be estimated.</span>

<span class="sd">        &gt; **Hc:** `list`</span>
<span class="sd">            -- Control Hamiltonians.</span>

<span class="sd">        &gt; **ctrl:** `list`</span>
<span class="sd">            -- Control coefficients.</span>

<span class="sd">        &gt; **decay:** `list`</span>
<span class="sd">            -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">            `decay=[[Gamma1, gamma1], [Gamma2,gamma2],...]`, where `Gamma1 (Gamma2)` </span>
<span class="sd">            represents the decay operator and `gamma1 (gamma2)` is the corresponding </span>
<span class="sd">            decay rate.</span>

<span class="sd">        &gt; **dyn_method:** `string`</span>
<span class="sd">            -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">            &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">            &quot;ode&quot; -- Solving the differential equations directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dH</span> <span class="o">=</span> <span class="n">dH</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span> <span class="o">=</span> <span class="n">Hc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">ctrl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay</span> <span class="o">=</span> <span class="n">decay</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="n">dyn_method</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamics of the density matrix of the form </span>
<span class="sd">        \begin{align}</span>
<span class="sd">        \rho=\sum_i K_i\rho_0K_i^{\dagger}</span>
<span class="sd">        \end{align}</span>

<span class="sd">        where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **K:** `multidimensional list`</span>
<span class="sd">            -- Kraus operator(s) with respect to the values in x.</span>

<span class="sd">        &gt; **dK:** `multidimensional list`</span>
<span class="sd">            -- Derivatives of the Kraus operator(s) with respect to the unknown parameters </span>
<span class="sd">            to be estimated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="n">dK</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">        In single parameter estimation the objective function is CFI and </span>
<span class="sd">        in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>

<span class="sd">        &gt; **M:** `list of matrices`</span>
<span class="sd">            -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">            is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">        **Note:** </span>
<span class="sd">            SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">            which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">            solutions.html).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="n">adaptive_dynamics</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
                <span class="n">M</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                <span class="n">W</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
                <span class="n">dyn_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="n">adaptive_Kraus</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
                <span class="n">M</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">,</span>
                <span class="n">W</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for type of dynamics, supported values are &#39;dynamics&#39; and &#39;Kraus&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">Mopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measurement optimization for the optimal x.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **W:** `matrix`</span>
<span class="sd">            -- Weight matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)):</span>
                        <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                            <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                            <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">expm</span><span class="p">()</span>
                        <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)):</span>
                        <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                            <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                            <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">ode</span><span class="p">()</span>
                        <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
                <span class="n">H_res</span><span class="p">,</span> <span class="n">dH_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
                <span class="n">H_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
                <span class="n">dH_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>

                <span class="n">p_list</span><span class="p">,</span> <span class="n">H_list</span><span class="p">,</span> <span class="n">dH_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">p_ele</span><span class="p">,</span> <span class="n">H_ele</span><span class="p">,</span> <span class="n">dH_ele</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p_ext</span><span class="p">,</span> <span class="n">H_ext</span><span class="p">,</span> <span class="n">dH_ext</span><span class="p">):</span>
                    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_ele</span><span class="p">)</span>
                    <span class="n">H_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H_ele</span><span class="p">)</span>
                    <span class="n">dH_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dH_ele</span><span class="p">)</span>

                <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_list</span><span class="p">)):</span>
                        <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">H_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dH_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                            <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                            <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">expm</span><span class="p">()</span>
                        <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">F_tp</span><span class="p">))))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_list</span><span class="p">)):</span>
                        <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">H_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dH_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                            <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                            <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">ode</span><span class="p">()</span>
                        <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">F_tp</span><span class="p">))))</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
                <span class="n">H_res</span><span class="p">,</span> <span class="n">dH_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_list</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dH_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">MeasurementOpt</span><span class="p">(</span><span class="n">mtype</span><span class="o">=</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="n">minput</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                <span class="n">H_res</span><span class="p">,</span>
                <span class="n">dH_res</span><span class="p">,</span>
                <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                <span class="n">dyn_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">hi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)):</span>
                    <span class="n">rho_tp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="k">for</span> <span class="n">Ki</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">hi</span><span class="p">]]</span>
                    <span class="p">)</span>
                    <span class="n">drho_tp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dKi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dKi</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">dKi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">hi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">[</span><span class="n">hi</span><span class="p">])</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span><span class="p">)</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span>

                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
                <span class="n">K_res</span><span class="p">,</span> <span class="n">dK_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>

                <span class="n">p_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
                <span class="n">K_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
                <span class="n">dK_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>

                <span class="n">p_list</span><span class="p">,</span> <span class="n">K_list</span><span class="p">,</span> <span class="n">dK_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">K_ele</span><span class="p">,</span> <span class="n">dK_ele</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">K_ext</span><span class="p">,</span> <span class="n">dK_ext</span><span class="p">):</span>
                    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_ele</span><span class="p">)</span>
                    <span class="n">K_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K_ele</span><span class="p">)</span>
                    <span class="n">dK_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dK_ele</span><span class="p">)</span>
                <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">hi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_list</span><span class="p">)):</span>
                    <span class="n">rho_tp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="k">for</span> <span class="n">Ki</span> <span class="ow">in</span> <span class="n">K_list</span><span class="p">[</span><span class="n">hi</span><span class="p">]]</span>
                    <span class="p">)</span>
                    <span class="n">dK_reshape</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">dK_list</span><span class="p">[</span><span class="n">hi</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_num</span><span class="p">)]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">drho_tp</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="nb">sum</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dKi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dKi</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                                <span class="k">for</span> <span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">dKi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">K_list</span><span class="p">[</span><span class="n">hi</span><span class="p">],</span> <span class="n">dKj</span><span class="p">)</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">dKj</span> <span class="ow">in</span> <span class="n">dK_reshape</span>
                    <span class="p">]</span>
                    <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">F_tp</span><span class="p">))))</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">p_shape</span><span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)))</span>
                <span class="n">K_res</span><span class="p">,</span> <span class="n">dK_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K_list</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">MeasurementOpt</span><span class="p">(</span><span class="n">mtype</span><span class="o">=</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="n">minput</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">K_res</span><span class="p">,</span> <span class="n">dK_res</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for type of dynamics, supported values are &#39;dynamics&#39; and &#39;Kraus&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span>
                <span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.Adapt.CFIM" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">CFIM</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.Adapt.CFIM" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Choose CFI or <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span> as the objective function. 
In single parameter estimation the objective function is CFI and 
in multiparameter estimation it will be <span class="arithmatex">\(\mathrm{Tr}(WI^{-1})\)</span>.</p>
<h4 id="quanestimation.Adapt.CFIM--parameters">Parameters<a class="headerlink" href="#quanestimation.Adapt.CFIM--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
<p><strong>M:</strong> <code>list of matrices</code>
    -- A set of positive operator-valued measure (POVM). The default measurement 
    is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</p>
</blockquote>
<p><strong>Note:</strong> 
    SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state 
    which can be downloaded from <a href="http://www.physics.umb.edu/Research/QBism/
    solutions.html">here</a>.</p>

          <details class="quote">
            <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">CFIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="p">[],</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Choose CFI or $\mathrm{Tr}(WI^{-1})$ as the objective function. </span>
<span class="sd">    In single parameter estimation the objective function is CFI and </span>
<span class="sd">    in multiparameter estimation it will be $\mathrm{Tr}(WI^{-1})$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>

<span class="sd">    &gt; **M:** `list of matrices`</span>
<span class="sd">        -- A set of positive operator-valued measure (POVM). The default measurement </span>
<span class="sd">        is a set of rank-one symmetric informationally complete POVM (SIC-POVM).</span>

<span class="sd">    **Note:** </span>
<span class="sd">        SIC-POVM is calculated by the Weyl-Heisenberg covariant SIC-POVM fiducial state </span>
<span class="sd">        which can be downloaded from [here](http://www.physics.umb.edu/Research/QBism/</span>
<span class="sd">        solutions.html).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">SIC</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="n">adaptive_dynamics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="n">M</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
            <span class="n">W</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="n">dyn_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="n">adaptive_Kraus</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="n">M</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">,</span>
            <span class="n">W</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_episode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savefile</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for type of dynamics, supported values are &#39;dynamics&#39; and &#39;Kraus&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.Adapt.Kraus" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">Kraus</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">)</span></code>

<a href="#quanestimation.Adapt.Kraus" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Dynamics of the density matrix of the form 
\begin{align}
\rho=\sum_i K_i\rho_0K_i^{\dagger}
\end{align}</p>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, <span class="arithmatex">\(K_i\)</span> is the Kraus operator.</p>
<h4 id="quanestimation.Adapt.Kraus--parameters">Parameters<a class="headerlink" href="#quanestimation.Adapt.Kraus--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>K:</strong> <code>multidimensional list</code>
    -- Kraus operator(s) with respect to the values in x.</p>
<p><strong>dK:</strong> <code>multidimensional list</code>
    -- Derivatives of the Kraus operator(s) with respect to the unknown parameters 
    to be estimated.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">dK</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dynamics of the density matrix of the form </span>
<span class="sd">    \begin{align}</span>
<span class="sd">    \rho=\sum_i K_i\rho_0K_i^{\dagger}</span>
<span class="sd">    \end{align}</span>

<span class="sd">    where $\rho$ is the evolved density matrix, $K_i$ is the Kraus operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **K:** `multidimensional list`</span>
<span class="sd">        -- Kraus operator(s) with respect to the values in x.</span>

<span class="sd">    &gt; **dK:** `multidimensional list`</span>
<span class="sd">        -- Derivatives of the Kraus operator(s) with respect to the unknown parameters </span>
<span class="sd">        to be estimated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dK</span> <span class="o">=</span> <span class="n">dK</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">=</span> <span class="s2">&quot;Kraus&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.Adapt.Mopt" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">Mopt</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#quanestimation.Adapt.Mopt" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Measurement optimization for the optimal x.</p>
<h4 id="quanestimation.Adapt.Mopt--parameters">Parameters<a class="headerlink" href="#quanestimation.Adapt.Mopt--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>W:</strong> <code>matrix</code>
    -- Weight matrix.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Mopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measurement optimization for the optimal x.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **W:** `matrix`</span>
<span class="sd">        -- Weight matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">W</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;dynamics&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)):</span>
                    <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                        <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                        <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">expm</span><span class="p">()</span>
                    <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)):</span>
                    <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                        <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                        <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">ode</span><span class="p">()</span>
                    <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
            <span class="n">H_res</span><span class="p">,</span> <span class="n">dH_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="n">H_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="n">dH_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>

            <span class="n">p_list</span><span class="p">,</span> <span class="n">H_list</span><span class="p">,</span> <span class="n">dH_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p_ele</span><span class="p">,</span> <span class="n">H_ele</span><span class="p">,</span> <span class="n">dH_ele</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p_ext</span><span class="p">,</span> <span class="n">H_ext</span><span class="p">,</span> <span class="n">dH_ext</span><span class="p">):</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_ele</span><span class="p">)</span>
                <span class="n">H_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H_ele</span><span class="p">)</span>
                <span class="n">dH_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dH_ele</span><span class="p">)</span>

            <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;expm&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_list</span><span class="p">)):</span>
                    <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">H_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dH_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                        <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                        <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">expm</span><span class="p">()</span>
                    <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">F_tp</span><span class="p">))))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">==</span> <span class="s2">&quot;ode&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_list</span><span class="p">)):</span>
                    <span class="n">dynamics</span> <span class="o">=</span> <span class="n">Lindblad</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">H_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dH_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
                        <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
                        <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">ode</span><span class="p">()</span>
                    <span class="n">rho</span><span class="p">,</span> <span class="n">drho</span> <span class="o">=</span> <span class="n">rho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">drho_tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">drho</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">F_tp</span><span class="p">))))</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
            <span class="n">H_res</span><span class="p">,</span> <span class="n">dH_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_list</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dH_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">MeasurementOpt</span><span class="p">(</span><span class="n">mtype</span><span class="o">=</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="n">minput</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">dynamics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="n">H_res</span><span class="p">,</span>
            <span class="n">dH_res</span><span class="p">,</span>
            <span class="n">Hc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Hc</span><span class="p">,</span>
            <span class="n">ctrl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span><span class="p">,</span>
            <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">,</span>
            <span class="n">dyn_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">==</span> <span class="s2">&quot;Kraus&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)):</span>
                <span class="n">rho_tp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="k">for</span> <span class="n">Ki</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">hi</span><span class="p">]]</span>
                <span class="p">)</span>
                <span class="n">drho_tp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dKi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dKi</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">dKi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">hi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">[</span><span class="n">hi</span><span class="p">])</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span><span class="p">)</span>
                <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span>

            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
            <span class="n">K_res</span><span class="p">,</span> <span class="n">dK_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>

            <span class="n">p_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="n">K_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
            <span class="n">dK_ext</span> <span class="o">=</span> <span class="n">extract_ele</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>

            <span class="n">p_list</span><span class="p">,</span> <span class="n">K_list</span><span class="p">,</span> <span class="n">dK_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">K_ele</span><span class="p">,</span> <span class="n">dK_ele</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">K_ext</span><span class="p">,</span> <span class="n">dK_ext</span><span class="p">):</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_ele</span><span class="p">)</span>
                <span class="n">K_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">K_ele</span><span class="p">)</span>
                <span class="n">dK_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dK_ele</span><span class="p">)</span>
            <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_list</span><span class="p">)):</span>
                <span class="n">rho_tp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="k">for</span> <span class="n">Ki</span> <span class="ow">in</span> <span class="n">K_list</span><span class="p">[</span><span class="n">hi</span><span class="p">]]</span>
                <span class="p">)</span>
                <span class="n">dK_reshape</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">[</span><span class="n">dK_list</span><span class="p">[</span><span class="n">hi</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_num</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_num</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">drho_tp</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">sum</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dKi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">dKi</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">Ki</span><span class="p">,</span> <span class="n">dKi</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">K_list</span><span class="p">[</span><span class="n">hi</span><span class="p">],</span> <span class="n">dKj</span><span class="p">)</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">dKj</span> <span class="ow">in</span> <span class="n">dK_reshape</span>
                <span class="p">]</span>
                <span class="n">F_tp</span> <span class="o">=</span> <span class="n">QFIM</span><span class="p">(</span><span class="n">rho_tp</span><span class="p">,</span> <span class="n">drho_tp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">F_tp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">F_tp</span><span class="p">))))</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">p_shape</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)))</span>
            <span class="n">K_res</span><span class="p">,</span> <span class="n">dK_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K_list</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">MeasurementOpt</span><span class="p">(</span><span class="n">mtype</span><span class="o">=</span><span class="s2">&quot;projection&quot;</span><span class="p">,</span> <span class="n">minput</span><span class="o">=</span><span class="p">[],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">Kraus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">K_res</span><span class="p">,</span> <span class="n">dK_res</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">CFIM</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for type of dynamics, supported values are &#39;dynamics&#39; and &#39;Kraus&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.Adapt.dynamics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dynamics</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s1">&#39;expm&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.Adapt.dynamics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Dynamics of the density matrix of the form </p>
<div class="arithmatex">\[\begin{align}
\partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\
&amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}
\left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),
\end{align}\]</div>
<p>where <span class="arithmatex">\(\rho\)</span> is the evolved density matrix, H is the Hamiltonian of the 
system, <span class="arithmatex">\(\Gamma_i\)</span> and <span class="arithmatex">\(\gamma_i\)</span> are the <span class="arithmatex">\(i\mathrm{th}\)</span> decay 
operator and decay rate.</p>
<h4 id="quanestimation.Adapt.dynamics--parameters">Parameters<a class="headerlink" href="#quanestimation.Adapt.dynamics--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>tspan:</strong> <code>array</code>
    -- Time length for the evolution.</p>
<p><strong>H0:</strong> <code>multidimensional list</code>
    -- Free Hamiltonian with respect to the values in x.</p>
<p><strong>dH:</strong> <code>multidimensional list</code>
    -- Derivatives of the free Hamiltonian with respect to the unknown parameters 
    to be estimated.</p>
<p><strong>Hc:</strong> <code>list</code>
    -- Control Hamiltonians.</p>
<p><strong>ctrl:</strong> <code>list</code>
    -- Control coefficients.</p>
<p><strong>decay:</strong> <code>list</code>
    -- Decay operators and the corresponding decay rates. Its input rule is 
    <code>decay=[[Gamma1, gamma1], [Gamma2,gamma2],...]</code>, where <code>Gamma1 (Gamma2)</code> 
    represents the decay operator and <code>gamma1 (gamma2)</code> is the corresponding 
    decay rate.</p>
<p><strong>dyn_method:</strong> <code>string</code>
    -- Setting the method for solving the Lindblad dynamics. Options are:<br />
    "expm" (default) -- Matrix exponential.<br />
    "ode" -- Solving the differential equations directly.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dH</span><span class="p">,</span> <span class="n">Hc</span><span class="o">=</span><span class="p">[],</span> <span class="n">ctrl</span><span class="o">=</span><span class="p">[],</span> <span class="n">decay</span><span class="o">=</span><span class="p">[],</span> <span class="n">dyn_method</span><span class="o">=</span><span class="s2">&quot;expm&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dynamics of the density matrix of the form </span>

<span class="sd">    \begin{align}</span>
<span class="sd">    \partial_t\rho &amp;=\mathcal{L}\rho \nonumber \\</span>
<span class="sd">    &amp;=-i[H,\rho]+\sum_i \gamma_i\left(\Gamma_i\rho\Gamma^{\dagger}_i-\frac{1}{2}</span>
<span class="sd">    \left\{\rho,\Gamma^{\dagger}_i \Gamma_i \right\}\right),</span>
<span class="sd">    \end{align} </span>

<span class="sd">    where $\rho$ is the evolved density matrix, H is the Hamiltonian of the </span>
<span class="sd">    system, $\Gamma_i$ and $\gamma_i$ are the $i\mathrm{th}$ decay </span>
<span class="sd">    operator and decay rate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **tspan:** `array`</span>
<span class="sd">        -- Time length for the evolution.</span>

<span class="sd">    &gt; **H0:** `multidimensional list`</span>
<span class="sd">        -- Free Hamiltonian with respect to the values in x.</span>

<span class="sd">    &gt; **dH:** `multidimensional list`</span>
<span class="sd">        -- Derivatives of the free Hamiltonian with respect to the unknown parameters </span>
<span class="sd">        to be estimated.</span>

<span class="sd">    &gt; **Hc:** `list`</span>
<span class="sd">        -- Control Hamiltonians.</span>

<span class="sd">    &gt; **ctrl:** `list`</span>
<span class="sd">        -- Control coefficients.</span>

<span class="sd">    &gt; **decay:** `list`</span>
<span class="sd">        -- Decay operators and the corresponding decay rates. Its input rule is </span>
<span class="sd">        `decay=[[Gamma1, gamma1], [Gamma2,gamma2],...]`, where `Gamma1 (Gamma2)` </span>
<span class="sd">        represents the decay operator and `gamma1 (gamma2)` is the corresponding </span>
<span class="sd">        decay rate.</span>

<span class="sd">    &gt; **dyn_method:** `string`</span>
<span class="sd">        -- Setting the method for solving the Lindblad dynamics. Options are:  </span>
<span class="sd">        &quot;expm&quot; (default) -- Matrix exponential.  </span>
<span class="sd">        &quot;ode&quot; -- Solving the differential equations directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tspan</span> <span class="o">=</span> <span class="n">tspan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dH</span> <span class="o">=</span> <span class="n">dH</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Hc</span> <span class="o">=</span> <span class="n">Hc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">ctrl</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decay</span> <span class="o">=</span> <span class="n">decay</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_type</span> <span class="o">=</span> <span class="s2">&quot;dynamics&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dyn_method</span> <span class="o">=</span> <span class="n">dyn_method</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<a id="quanestimation.Adapt_MZI"></a>
  <div class="doc doc-contents first">

  
      <h3 id="quanestimation.Adapt_MZI--attributes">Attributes<a class="headerlink" href="#quanestimation.Adapt_MZI--attributes" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>x:</strong> <code>list</code>
    -- The regimes of the parameters for the integral.</p>
<p><strong>p:</strong> <code>multidimensional array</code>
    -- The prior distribution.</p>
<p><strong>rho0:</strong> <code>matrix</code>
    -- Initial state (density matrix).</p>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt_MZI.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Adapt_MZI</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **x:** `list`</span>
<span class="sd">        -- The regimes of the parameters for the integral.</span>

<span class="sd">    &gt; **p:** `multidimensional array`</span>
<span class="sd">        -- The prior distribution.</span>

<span class="sd">    &gt; **rho0:** `matrix`</span>
<span class="sd">        -- Initial state (density matrix).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho0</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span> <span class="o">=</span> <span class="n">rho0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho0</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># self.a = annihilation(self.N + 1)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">general</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MZI_type</span> <span class="o">=</span> <span class="s2">&quot;general&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">online</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;sharpness&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;phi&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Setting the target function for calculating the tunable phase. Options are:  </span>
<span class="sd">            &quot;sharpness&quot; (default) -- Sharpness.  </span>
<span class="sd">            &quot;MI&quot; -- Mutual information. </span>

<span class="sd">        &gt; **output:** `string`</span>
<span class="sd">            -- The output the class. Options are:  </span>
<span class="sd">            &quot;phi&quot; (default) -- The tunable phase.  </span>
<span class="sd">            &quot;dphi&quot; -- Phase difference. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">adaptMZI_online</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">target</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">offline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;sharpness&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">,</span>
        <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">deltaphi0</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">cr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">c2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt; **target:** `string`</span>
<span class="sd">            -- Setting the target function for calculating the tunable phase. Options are:  </span>
<span class="sd">            &quot;sharpness&quot; (default) -- Sharpness.  </span>
<span class="sd">            &quot;MI&quot; -- Mutual information. </span>

<span class="sd">        &gt; **method:** `string`</span>
<span class="sd">            -- The method for the adaptive phase estimation. Options are:  </span>
<span class="sd">            &quot;DE&quot; (default) -- DE algorithm for the adaptive phase estimation.    </span>
<span class="sd">            &quot;PSO&quot; -- PSO algorithm for the adaptive phase estimation.</span>

<span class="sd">        If the `method=DE`, the parameters are:</span>
<span class="sd">        &gt; **p_num:** `int`</span>
<span class="sd">            -- The number of populations.</span>

<span class="sd">        &gt; **deltaphi0:** `list`</span>
<span class="sd">            -- Initial guesses of phase difference.</span>

<span class="sd">        &gt; **max_episode:** `int`</span>
<span class="sd">            -- The number of episodes.</span>

<span class="sd">        &gt; **c:** `float`</span>
<span class="sd">            -- Mutation constant.</span>

<span class="sd">        &gt; **cr:** `float`</span>
<span class="sd">            -- Crossover constant.</span>

<span class="sd">        &gt; **seed:** `int`</span>
<span class="sd">            -- Random seed.</span>

<span class="sd">        &gt; **eps:** `float`</span>
<span class="sd">            -- Machine epsilon.</span>

<span class="sd">        If the `method=PSO`, the parameters are:</span>

<span class="sd">        &gt; **deltaphi0:** `list`</span>
<span class="sd">            -- Initial guesses of phase difference.</span>

<span class="sd">        &gt; **max_episode:** `int or list`</span>
<span class="sd">            -- If it is an integer, for example max_episode=1000, it means the </span>
<span class="sd">            program will continuously run 1000 episodes. However, if it is an</span>
<span class="sd">            array, for example max_episode=[1000,100], the program will run </span>
<span class="sd">            1000 episodes in total but replace states of all  the particles </span>
<span class="sd">            with global best every 100 episodes.</span>

<span class="sd">        &gt; **c0:** `float`</span>
<span class="sd">            -- The damping factor that assists convergence, also known as inertia weight.</span>

<span class="sd">        &gt; **c1:** `float`</span>
<span class="sd">            -- The exploitation weight that attracts the particle to its best previous </span>
<span class="sd">            position, also known as cognitive learning factor.</span>

<span class="sd">        &gt; **c2:** `float`</span>
<span class="sd">            -- The exploitation weight that attracts the particle to the best position  </span>
<span class="sd">            in the neighborhood, also known as social learning factor.</span>

<span class="sd">        &gt; **eps:** `float`</span>
<span class="sd">            -- Machine epsilon.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">comb_tp</span> <span class="o">=</span> <span class="n">brgd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">comb</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">comb_tp</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;DE&quot;</span><span class="p">:</span>
            <span class="n">QJL</span><span class="o">.</span><span class="n">DE_deltaphiOpt</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                <span class="n">comb</span><span class="p">,</span>
                <span class="n">p_num</span><span class="p">,</span>
                <span class="n">deltaphi0</span><span class="p">,</span>
                <span class="n">c</span><span class="p">,</span>
                <span class="n">cr</span><span class="p">,</span>
                <span class="n">seed</span><span class="p">,</span>
                <span class="n">max_episode</span><span class="p">,</span>
                <span class="n">target</span><span class="p">,</span>
                <span class="n">eps</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PSO&quot;</span><span class="p">:</span>
            <span class="n">QJL</span><span class="o">.</span><span class="n">PSO_deltaphiOpt</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
                <span class="n">comb</span><span class="p">,</span>
                <span class="n">p_num</span><span class="p">,</span>
                <span class="n">deltaphi0</span><span class="p">,</span>
                <span class="n">c0</span><span class="p">,</span>
                <span class="n">c1</span><span class="p">,</span>
                <span class="n">c2</span><span class="p">,</span>
                <span class="n">seed</span><span class="p">,</span>
                <span class="n">max_episode</span><span class="p">,</span>
                <span class="n">target</span><span class="p">,</span>
                <span class="n">eps</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for method, supported values are &#39;DE&#39; and &#39;PSO&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">method</span>
                <span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="quanestimation.Adapt_MZI.offline" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">offline</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;sharpness&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">deltaphi0</span><span class="o">=</span><span class="p">[],</span> <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>

<a href="#quanestimation.Adapt_MZI.offline" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <h4 id="quanestimation.Adapt_MZI.offline--parameters">Parameters<a class="headerlink" href="#quanestimation.Adapt_MZI.offline--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>target:</strong> <code>string</code>
    -- Setting the target function for calculating the tunable phase. Options are:<br />
    "sharpness" (default) -- Sharpness.<br />
    "MI" -- Mutual information. </p>
<p><strong>method:</strong> <code>string</code>
    -- The method for the adaptive phase estimation. Options are:<br />
    "DE" (default) -- DE algorithm for the adaptive phase estimation.  <br />
    "PSO" -- PSO algorithm for the adaptive phase estimation.</p>
</blockquote>
<p>If the <code>method=DE</code>, the parameters are:</p>
<blockquote>
<p><strong>p_num:</strong> <code>int</code>
    -- The number of populations.</p>
<p><strong>deltaphi0:</strong> <code>list</code>
    -- Initial guesses of phase difference.</p>
<p><strong>max_episode:</strong> <code>int</code>
    -- The number of episodes.</p>
<p><strong>c:</strong> <code>float</code>
    -- Mutation constant.</p>
<p><strong>cr:</strong> <code>float</code>
    -- Crossover constant.</p>
<p><strong>seed:</strong> <code>int</code>
    -- Random seed.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
</blockquote>
<p>If the <code>method=PSO</code>, the parameters are:</p>
<blockquote>
<p><strong>deltaphi0:</strong> <code>list</code>
    -- Initial guesses of phase difference.</p>
<p><strong>max_episode:</strong> <code>int or list</code>
    -- If it is an integer, for example max_episode=1000, it means the 
    program will continuously run 1000 episodes. However, if it is an
    array, for example max_episode=[1000,100], the program will run 
    1000 episodes in total but replace states of all  the particles 
    with global best every 100 episodes.</p>
<p><strong>c0:</strong> <code>float</code>
    -- The damping factor that assists convergence, also known as inertia weight.</p>
<p><strong>c1:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to its best previous 
    position, also known as cognitive learning factor.</p>
<p><strong>c2:</strong> <code>float</code>
    -- The exploitation weight that attracts the particle to the best position<br />
    in the neighborhood, also known as social learning factor.</p>
<p><strong>eps:</strong> <code>float</code>
    -- Machine epsilon.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt_MZI.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">offline</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;sharpness&quot;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">,</span>
    <span class="n">p_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">deltaphi0</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">cr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">c0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">c1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">c2</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span>
    <span class="n">max_episode</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Setting the target function for calculating the tunable phase. Options are:  </span>
<span class="sd">        &quot;sharpness&quot; (default) -- Sharpness.  </span>
<span class="sd">        &quot;MI&quot; -- Mutual information. </span>

<span class="sd">    &gt; **method:** `string`</span>
<span class="sd">        -- The method for the adaptive phase estimation. Options are:  </span>
<span class="sd">        &quot;DE&quot; (default) -- DE algorithm for the adaptive phase estimation.    </span>
<span class="sd">        &quot;PSO&quot; -- PSO algorithm for the adaptive phase estimation.</span>

<span class="sd">    If the `method=DE`, the parameters are:</span>
<span class="sd">    &gt; **p_num:** `int`</span>
<span class="sd">        -- The number of populations.</span>

<span class="sd">    &gt; **deltaphi0:** `list`</span>
<span class="sd">        -- Initial guesses of phase difference.</span>

<span class="sd">    &gt; **max_episode:** `int`</span>
<span class="sd">        -- The number of episodes.</span>

<span class="sd">    &gt; **c:** `float`</span>
<span class="sd">        -- Mutation constant.</span>

<span class="sd">    &gt; **cr:** `float`</span>
<span class="sd">        -- Crossover constant.</span>

<span class="sd">    &gt; **seed:** `int`</span>
<span class="sd">        -- Random seed.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>

<span class="sd">    If the `method=PSO`, the parameters are:</span>

<span class="sd">    &gt; **deltaphi0:** `list`</span>
<span class="sd">        -- Initial guesses of phase difference.</span>

<span class="sd">    &gt; **max_episode:** `int or list`</span>
<span class="sd">        -- If it is an integer, for example max_episode=1000, it means the </span>
<span class="sd">        program will continuously run 1000 episodes. However, if it is an</span>
<span class="sd">        array, for example max_episode=[1000,100], the program will run </span>
<span class="sd">        1000 episodes in total but replace states of all  the particles </span>
<span class="sd">        with global best every 100 episodes.</span>

<span class="sd">    &gt; **c0:** `float`</span>
<span class="sd">        -- The damping factor that assists convergence, also known as inertia weight.</span>

<span class="sd">    &gt; **c1:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to its best previous </span>
<span class="sd">        position, also known as cognitive learning factor.</span>

<span class="sd">    &gt; **c2:** `float`</span>
<span class="sd">        -- The exploitation weight that attracts the particle to the best position  </span>
<span class="sd">        in the neighborhood, also known as social learning factor.</span>

<span class="sd">    &gt; **eps:** `float`</span>
<span class="sd">        -- Machine epsilon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">comb_tp</span> <span class="o">=</span> <span class="n">brgd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    <span class="n">comb</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">comb_tp</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;DE&quot;</span><span class="p">:</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">DE_deltaphiOpt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="n">comb</span><span class="p">,</span>
            <span class="n">p_num</span><span class="p">,</span>
            <span class="n">deltaphi0</span><span class="p">,</span>
            <span class="n">c</span><span class="p">,</span>
            <span class="n">cr</span><span class="p">,</span>
            <span class="n">seed</span><span class="p">,</span>
            <span class="n">max_episode</span><span class="p">,</span>
            <span class="n">target</span><span class="p">,</span>
            <span class="n">eps</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PSO&quot;</span><span class="p">:</span>
        <span class="n">QJL</span><span class="o">.</span><span class="n">PSO_deltaphiOpt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span>
            <span class="n">comb</span><span class="p">,</span>
            <span class="n">p_num</span><span class="p">,</span>
            <span class="n">deltaphi0</span><span class="p">,</span>
            <span class="n">c0</span><span class="p">,</span>
            <span class="n">c1</span><span class="p">,</span>
            <span class="n">c2</span><span class="p">,</span>
            <span class="n">seed</span><span class="p">,</span>
            <span class="n">max_episode</span><span class="p">,</span>
            <span class="n">target</span><span class="p">,</span>
            <span class="n">eps</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2"> is not a valid value for method, supported values are &#39;DE&#39; and &#39;PSO&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">method</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="quanestimation.Adapt_MZI.online" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">online</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;sharpness&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;phi&#39;</span><span class="p">)</span></code>

<a href="#quanestimation.Adapt_MZI.online" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <h4 id="quanestimation.Adapt_MZI.online--parameters">Parameters<a class="headerlink" href="#quanestimation.Adapt_MZI.online--parameters" title="Permanent link">&para;</a></h4>
<blockquote>
<p><strong>target:</strong> <code>string</code>
    -- Setting the target function for calculating the tunable phase. Options are:<br />
    "sharpness" (default) -- Sharpness.<br />
    "MI" -- Mutual information. </p>
<p><strong>output:</strong> <code>string</code>
    -- The output the class. Options are:<br />
    "phi" (default) -- The tunable phase.<br />
    "dphi" -- Phase difference.</p>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>quanestimation/AdaptiveScheme/Adapt_MZI.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">online</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;sharpness&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;phi&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt; **target:** `string`</span>
<span class="sd">        -- Setting the target function for calculating the tunable phase. Options are:  </span>
<span class="sd">        &quot;sharpness&quot; (default) -- Sharpness.  </span>
<span class="sd">        &quot;MI&quot; -- Mutual information. </span>

<span class="sd">    &gt; **output:** `string`</span>
<span class="sd">        -- The output the class. Options are:  </span>
<span class="sd">        &quot;phi&quot; (default) -- The tunable phase.  </span>
<span class="sd">        &quot;dphi&quot; -- Phase difference. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">QJL</span><span class="o">.</span><span class="n">adaptMZI_online</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho0</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">target</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "navigation.tabs", "navigation.top"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="../../../javascripts/mathjaxhelper.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>